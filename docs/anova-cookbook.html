<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Just enough R</title>
  <meta name="description" content="‘Just enough’ R">
  <meta name="generator" content="bookdown 0.4 and GitBook 2.6.7">

  <meta property="og:title" content="Just enough R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Just enough R" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="anova.html">
<link rel="next" href="understanding-interactions.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="https://hypothes.is/embed.js" async></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Just enough R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="start_here.html"><a href="start_here.html"><i class="fa fa-check"></i><b>2</b> Getting started with R and RStudio</a></li>
<li class="chapter" data-level="3" data-path="datasets.html"><a href="datasets.html"><i class="fa fa-check"></i><b>3</b> Datasets and dataframes</a></li>
<li class="chapter" data-level="4" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html"><i class="fa fa-check"></i><b>4</b> Placeholder</a></li>
<li class="chapter" data-level="5" data-path="summarising-data.html"><a href="summarising-data.html"><i class="fa fa-check"></i><b>5</b> Summarising data</a></li>
<li class="chapter" data-level="6" data-path="graphics.html"><a href="graphics.html"><i class="fa fa-check"></i><b>6</b> Graphics</a></li>
<li class="chapter" data-level="7" data-path="real-data.html"><a href="real-data.html"><i class="fa fa-check"></i><b>7</b> Working with ‘real’ data</a></li>
<li class="chapter" data-level="8" data-path="correlations.html"><a href="correlations.html"><i class="fa fa-check"></i><b>8</b> Correlations</a></li>
<li class="chapter" data-level="9" data-path="t-tests.html"><a href="t-tests.html"><i class="fa fa-check"></i><b>9</b> t-tests</a></li>
<li class="chapter" data-level="10" data-path="linear-models-simple.html"><a href="linear-models-simple.html"><i class="fa fa-check"></i><b>10</b> Introduction to linear models in R</a></li>
<li class="chapter" data-level="11" data-path="anova.html"><a href="anova.html"><i class="fa fa-check"></i><b>11</b> Anova in R</a></li>
<li class="chapter" data-level="12" data-path="anova-cookbook.html"><a href="anova-cookbook.html"><i class="fa fa-check"></i><b>12</b> Anova ‘Cookbook’</a><ul>
<li class="chapter" data-level="12.1" data-path="anova-cookbook.html"><a href="anova-cookbook.html#between-subjects-designs"><i class="fa fa-check"></i><b>12.1</b> Between subjects designs</a><ul>
<li class="chapter" data-level="12.1.1" data-path="anova-cookbook.html"><a href="anova-cookbook.html#factorial-anova-no-bigger-than-2x2"><i class="fa fa-check"></i><b>12.1.1</b> Factorial anova, no bigger than 2x2</a></li>
<li class="chapter" data-level="12.1.2" data-path="anova-cookbook.html"><a href="anova-cookbook.html#factorial-anova-where-one-factor-has-2-levels."><i class="fa fa-check"></i><b>12.1.2</b> Factorial anova, where one factor has &gt; 2 levels.</a></li>
<li class="chapter" data-level="" data-path="anova-cookbook.html"><a href="anova-cookbook.html#checking-assumptions"><i class="fa fa-check"></i>Checking assumptions</a></li>
<li class="chapter" data-level="" data-path="anova-cookbook.html"><a href="anova-cookbook.html#post-hoc-tests"><i class="fa fa-check"></i>Post hoc tests</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="anova-cookbook.html"><a href="anova-cookbook.html#repeated-measures-or-split-plot-designs"><i class="fa fa-check"></i><b>12.2</b> Repeated measures or ‘split plot’ designs</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="understanding-interactions.html"><a href="understanding-interactions.html"><i class="fa fa-check"></i><b>13</b> Understanding interactions (part 1)</a></li>
<li class="chapter" data-level="14" data-path="predictions-and-margins.html"><a href="predictions-and-margins.html"><i class="fa fa-check"></i><b>14</b> Making predictions</a></li>
<li class="chapter" data-level="15" data-path="mediation.html"><a href="mediation.html"><i class="fa fa-check"></i><b>15</b> Mediation</a></li>
<li class="chapter" data-level="16" data-path="multilevel-models.html"><a href="multilevel-models.html"><i class="fa fa-check"></i><b>16</b> Multilevel models</a></li>
<li class="chapter" data-level="17" data-path="cfa.html"><a href="cfa.html"><i class="fa fa-check"></i><b>17</b> Confirmatory factor analysis</a></li>
<li class="chapter" data-level="18" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>18</b> Installing R and RStudio</a></li>
<li class="chapter" data-level="19" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>19</b> Loading packages</a></li>
<li class="chapter" data-level="20" data-path="help.html"><a href="help.html"><i class="fa fa-check"></i><b>20</b> Getting help</a></li>
<li class="chapter" data-level="21" data-path="missing-values.html"><a href="missing-values.html"><i class="fa fa-check"></i><b>21</b> Missing values</a></li>
<li class="chapter" data-level="22" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html"><i class="fa fa-check"></i><b>22</b> Tips and tricks with RMarkdown</a></li>
<li class="chapter" data-level="23" data-path="confidence-vs-prediction-intervals.html"><a href="confidence-vs-prediction-intervals.html"><i class="fa fa-check"></i><b>23</b> Confidence, credible and prediction intervals</a></li>
<li class="chapter" data-level="24" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>24</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">‘Just enough’ R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="anova-cookbook" class="section level1">
<h1><span class="header-section-number">12</span> Anova ‘Cookbook’</h1>
<p>This section is intended as a shortcut to running Anova for a variety of common types of model. If you want to understand more about what you are doing, read the section on <a href="anova.html">principles of Anova in R</a>.</p>
<div id="between-subjects-designs" class="section level2">
<h2><span class="header-section-number">12.1</span> Between subjects designs</h2>
<div id="factorial-anova-no-bigger-than-2x2" class="section level3">
<h3><span class="header-section-number">12.1.1</span> Factorial anova, no bigger than 2x2</h3>
</div>
<div id="factorial-anova-where-one-factor-has-2-levels." class="section level3">
<h3><span class="header-section-number">12.1.2</span> Factorial anova, where one factor has &gt; 2 levels.</h3>
<p>We are using a dataset from Howell (REF), chapter 13 which recorded <code>Recall</code> among young v.s. older adults (<code>Age</code>) for each of 5 conditions.</p>
<p>This data would commonly be plotted something like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eysenck &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;data/eysenck.Rdata&quot;</span>)
eysenck <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Condition, Recall, <span class="dt">group=</span>Age, <span class="dt">color=</span>Age)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">stat_summary</span>(<span class="dt">geom=</span><span class="st">&quot;pointrange&quot;</span>, <span class="dt">fun.data =</span> mean_cl_boot) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Recall (95% CI)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>)</code></pre></div>
<p><img src="anova-cookbook_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Or alternatively if we wanted to provde a better summary of the distribution of the raw data we could use a boxplot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eysenck <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Age, Recall)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">width=</span>.<span class="dv">33</span>) <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(<span class="op">~</span>Condition) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Recall (95% CI)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>)</code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-5"></span>
<img src="anova-cookbook_files/figure-html/unnamed-chunk-5-1.png" alt="Boxplot for recall in older and young adults, by condition." width="672" />
<p class="caption">
Figure 12.1: Boxplot for recall in older and young adults, by condition.
</p>
</div>
<p>We can run a linear model including the effect of <code>Age</code> and <code>Condition</code> and the interaction of these variables, and calculate the Anova:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eysenck.model &lt;-<span class="st"> </span><span class="kw">lm</span>(Recall<span class="op">~</span>Age<span class="op">*</span>Condition, <span class="dt">data=</span>eysenck)
car<span class="op">::</span><span class="kw">Anova</span>(eysenck.model, <span class="dt">type=</span><span class="dv">3</span>)
## Anova Table (Type III tests)
## 
## Response: Recall
##               Sum Sq Df F value    Pr(&gt;F)    
## (Intercept)   490.00  1 61.0550  9.85e-12 ***
## Age             1.25  1  0.1558 0.6940313    
## Condition     351.52  4 10.9500  2.80e-07 ***
## Age:Condition 190.30  4  5.9279 0.0002793 ***
## Residuals     722.30 90                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre></div>
</div>
<div id="checking-assumptions" class="section level3 unnumbered">
<h3>Checking assumptions</h3>
<p>If we want to check assumptions of the model are met, these tables and plots would be a reasonable place to start. First running Levene’s test:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">car<span class="op">::</span><span class="kw">leveneTest</span>(eysenck.model) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">pander</span>()</code></pre></div>
<table style="width:51%;">
<caption>Levene’s Test for Homogeneity of Variance (center = median)</caption>
<colgroup>
<col width="16%" />
<col width="6%" />
<col width="13%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Df</th>
<th align="center">F value</th>
<th align="center">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>group</strong></td>
<td align="center">9</td>
<td align="center">1.031</td>
<td align="center">0.4217</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="center">90</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
</tbody>
</table>
<p>Then a QQ-plot of the model residuals to assess normality:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">car<span class="op">::</span><span class="kw">qqPlot</span>(eysenck.model)</code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-8"></span>
<img src="anova-cookbook_files/figure-html/unnamed-chunk-8-1.png" alt="QQ plot to assess normality of model residuals" width="672" />
<p class="caption">
Figure 12.2: QQ plot to assess normality of model residuals
</p>
</div>
<p>And finally a residual-vs-fitted plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># we have to make a dataframe containing the fitted values and residuals first</span>
<span class="kw">data_frame</span>(
  <span class="dt">fitted =</span> <span class="kw">predict</span>(eysenck.model), 
  <span class="dt">residual =</span> <span class="kw">residuals</span>(eysenck.model)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># and then plot points and a smoothed line</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(fitted, residual)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">se=</span>F)
## `geom_smooth()` using method = &#39;loess&#39;</code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-9"></span>
<img src="anova-cookbook_files/figure-html/unnamed-chunk-9-1.png" alt="Residual vs fitted (spread vs. level) plot to check homogeneity of variance." width="672" />
<p class="caption">
Figure 12.3: Residual vs fitted (spread vs. level) plot to check homogeneity of variance.
</p>
</div>
</div>
<div id="post-hoc-tests" class="section level3 unnumbered">
<h3>Post hoc tests</h3>
<p>If we want to look at post-hoc pairwise tests we can use the the <code>lsmeans()</code> function from the <code>lsmeans::</code> package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lsmeans<span class="op">::</span><span class="kw">lsmeans</span>(eysenck.model, pairwise<span class="op">~</span>Age<span class="op">:</span>Condition)
## $lsmeans
##  Age   Condition lsmean        SE df  lower.CL  upper.CL
##  Young Counting     7.0 0.8958547 90  5.220228  8.779772
##  Older Counting     6.5 0.8958547 90  4.720228  8.279772
##  Young Rhyming      6.9 0.8958547 90  5.120228  8.679772
##  Older Rhyming      7.6 0.8958547 90  5.820228  9.379772
##  Young Adjective   11.0 0.8958547 90  9.220228 12.779772
##  Older Adjective   14.8 0.8958547 90 13.020228 16.579772
##  Young Imagery     13.4 0.8958547 90 11.620228 15.179772
##  Older Imagery     17.6 0.8958547 90 15.820228 19.379772
##  Young Intention   12.0 0.8958547 90 10.220228 13.779772
##  Older Intention   19.3 0.8958547 90 17.520228 21.079772
## 
## Confidence level used: 0.95 
## 
## $contrasts
##  contrast                          estimate      SE df t.ratio p.value
##  Young,Counting - Older,Counting        0.5 1.26693 90   0.395  1.0000
##  Young,Counting - Young,Rhyming         0.1 1.26693 90   0.079  1.0000
##  Young,Counting - Older,Rhyming        -0.6 1.26693 90  -0.474  1.0000
##  Young,Counting - Young,Adjective      -4.0 1.26693 90  -3.157  0.0633
##  Young,Counting - Older,Adjective      -7.8 1.26693 90  -6.157  &lt;.0001
##  Young,Counting - Young,Imagery        -6.4 1.26693 90  -5.052  0.0001
##  Young,Counting - Older,Imagery       -10.6 1.26693 90  -8.367  &lt;.0001
##  Young,Counting - Young,Intention      -5.0 1.26693 90  -3.947  0.0058
##  Young,Counting - Older,Intention     -12.3 1.26693 90  -9.709  &lt;.0001
##  Older,Counting - Young,Rhyming        -0.4 1.26693 90  -0.316  1.0000
##  Older,Counting - Older,Rhyming        -1.1 1.26693 90  -0.868  0.9970
##  Older,Counting - Young,Adjective      -4.5 1.26693 90  -3.552  0.0205
##  Older,Counting - Older,Adjective      -8.3 1.26693 90  -6.551  &lt;.0001
##  Older,Counting - Young,Imagery        -6.9 1.26693 90  -5.446  &lt;.0001
##  Older,Counting - Older,Imagery       -11.1 1.26693 90  -8.761  &lt;.0001
##  Older,Counting - Young,Intention      -5.5 1.26693 90  -4.341  0.0015
##  Older,Counting - Older,Intention     -12.8 1.26693 90 -10.103  &lt;.0001
##  Young,Rhyming - Older,Rhyming         -0.7 1.26693 90  -0.553  0.9999
##  Young,Rhyming - Young,Adjective       -4.1 1.26693 90  -3.236  0.0511
##  Young,Rhyming - Older,Adjective       -7.9 1.26693 90  -6.236  &lt;.0001
##  Young,Rhyming - Young,Imagery         -6.5 1.26693 90  -5.131  0.0001
##  Young,Rhyming - Older,Imagery        -10.7 1.26693 90  -8.446  &lt;.0001
##  Young,Rhyming - Young,Intention       -5.1 1.26693 90  -4.025  0.0044
##  Young,Rhyming - Older,Intention      -12.4 1.26693 90  -9.787  &lt;.0001
##  Older,Rhyming - Young,Adjective       -3.4 1.26693 90  -2.684  0.1963
##  Older,Rhyming - Older,Adjective       -7.2 1.26693 90  -5.683  &lt;.0001
##  Older,Rhyming - Young,Imagery         -5.8 1.26693 90  -4.578  0.0006
##  Older,Rhyming - Older,Imagery        -10.0 1.26693 90  -7.893  &lt;.0001
##  Older,Rhyming - Young,Intention       -4.4 1.26693 90  -3.473  0.0260
##  Older,Rhyming - Older,Intention      -11.7 1.26693 90  -9.235  &lt;.0001
##  Young,Adjective - Older,Adjective     -3.8 1.26693 90  -2.999  0.0950
##  Young,Adjective - Young,Imagery       -2.4 1.26693 90  -1.894  0.6728
##  Young,Adjective - Older,Imagery       -6.6 1.26693 90  -5.209  0.0001
##  Young,Adjective - Young,Intention     -1.0 1.26693 90  -0.789  0.9986
##  Young,Adjective - Older,Intention     -8.3 1.26693 90  -6.551  &lt;.0001
##  Older,Adjective - Young,Imagery        1.4 1.26693 90   1.105  0.9830
##  Older,Adjective - Older,Imagery       -2.8 1.26693 90  -2.210  0.4578
##  Older,Adjective - Young,Intention      2.8 1.26693 90   2.210  0.4578
##  Older,Adjective - Older,Intention     -4.5 1.26693 90  -3.552  0.0205
##  Young,Imagery - Older,Imagery         -4.2 1.26693 90  -3.315  0.0411
##  Young,Imagery - Young,Intention        1.4 1.26693 90   1.105  0.9830
##  Young,Imagery - Older,Intention       -5.9 1.26693 90  -4.657  0.0005
##  Older,Imagery - Young,Intention        5.6 1.26693 90   4.420  0.0011
##  Older,Imagery - Older,Intention       -1.7 1.26693 90  -1.342  0.9409
##  Young,Intention - Older,Intention     -7.3 1.26693 90  -5.762  &lt;.0001
## 
## P value adjustment: tukey method for comparing a family of 10 estimates</code></pre></div>
<p>By default Tukey correction is applied for multiple comparisons which is a reasonable default. If you want to use other methods (e.g. to use false discovery rate adjustment) you can use the <code>adjust</code> argument. In the code below we use the <code>broom::tidy()</code> function to convert the table into a dataframe, and then show only the first 6 rows as a table in RMarkdown:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># calculate pairwise contrasts</span>
eysenck.fdr &lt;-<span class="st"> </span>lsmeans<span class="op">::</span><span class="kw">lsmeans</span>(eysenck.model, pairwise<span class="op">~</span>Age<span class="op">:</span>Condition, <span class="dt">adjust=</span><span class="st">&quot;fdr&quot;</span>)
<span class="co"># show first 6 rows from this long table</span>
eysenck.fdr<span class="op">$</span>contrasts <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>broom<span class="op">::</span><span class="kw">tidy</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">6</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">pander</span>(<span class="dt">caption=</span><span class="st">&quot;First 6 rows of the pairwise contrasts with FDR-adjusted p values&quot;</span>)</code></pre></div>
<table>
<caption>First 6 rows of the pairwise contrasts with FDR-adjusted p values</caption>
<colgroup>
<col width="18%" />
<col width="20%" />
<col width="13%" />
<col width="15%" />
<col width="6%" />
<col width="15%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">level1</th>
<th align="center">level2</th>
<th align="center">estimate</th>
<th align="center">std.error</th>
<th align="center">df</th>
<th align="center">statistic</th>
<th align="center">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Young,Counting</td>
<td align="center">Older,Counting</td>
<td align="center">0.5</td>
<td align="center">1.267</td>
<td align="center">90</td>
<td align="center">0.3947</td>
<td align="center">0.7263</td>
</tr>
<tr class="even">
<td align="center">Young,Counting</td>
<td align="center">Young,Rhyming</td>
<td align="center">0.1</td>
<td align="center">1.267</td>
<td align="center">90</td>
<td align="center">0.07893</td>
<td align="center">0.9373</td>
</tr>
<tr class="odd">
<td align="center">Young,Counting</td>
<td align="center">Older,Rhyming</td>
<td align="center">-0.6</td>
<td align="center">1.267</td>
<td align="center">90</td>
<td align="center">-0.4736</td>
<td align="center">0.6824</td>
</tr>
<tr class="even">
<td align="center">Young,Counting</td>
<td align="center">Young,Adjective</td>
<td align="center">-4</td>
<td align="center">1.267</td>
<td align="center">90</td>
<td align="center">-3.157</td>
<td align="center">0.003251</td>
</tr>
<tr class="odd">
<td align="center">Young,Counting</td>
<td align="center">Older,Adjective</td>
<td align="center">-7.8</td>
<td align="center">1.267</td>
<td align="center">90</td>
<td align="center">-6.157</td>
<td align="center">7.626e-08</td>
</tr>
<tr class="even">
<td align="center">Young,Counting</td>
<td align="center">Young,Imagery</td>
<td align="center">-6.4</td>
<td align="center">1.267</td>
<td align="center">90</td>
<td align="center">-5.052</td>
<td align="center">5.698e-06</td>
</tr>
</tbody>
</table>
<p>You should note that the FDR adjusted p values do not represent probabilities in the normal sense. Instead, the p value now indicates the <em>false discovery rate at which the p value should be considered statistically significant</em>. So, for example, if the adjusted p value 0.09, then this indicates the contrast <em>would</em> be significant if the acceptable false discovery rate is 10% (people often set their acceptable false discover rate to be 5% out of habit, but this is not always appropriate).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Set our acceptable false discovery rate to 10%</span>
FDR &lt;-<span class="st"> </span>.<span class="dv">1</span>
lsmeans<span class="op">::</span><span class="kw">lsmeans</span>(eysenck.model, pairwise<span class="op">~</span>Age<span class="op">:</span>Condition, <span class="dt">adjust=</span><span class="st">&quot;none&quot;</span>)<span class="op">$</span>contrast <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>broom<span class="op">::</span><span class="kw">tidy</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(level1, level2, p.value) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(p.value) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">q (10% FDR)</span><span class="st">`</span> =<span class="st"> </span>(<span class="kw">rank</span>(p.value)<span class="op">/</span><span class="kw">length</span>(p.value))<span class="op">*</span>FDR) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">p.fdr.adjust=</span><span class="kw">p.adjust</span>(p.value, <span class="dt">method=</span><span class="st">&quot;BH&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">significant =</span> <span class="kw">as.numeric</span>(p.value <span class="op">&lt;</span><span class="st"> `</span><span class="dt">q (10% FDR)</span><span class="st">`</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># just show some of the results, at the break between sig and ns contrast</span>
<span class="st">  </span><span class="kw">filter</span>(p.fdr.adjust <span class="op">&gt;</span><span class="st"> </span>.<span class="dv">01</span> <span class="op">&amp;</span><span class="st"> </span>p.fdr.adjust <span class="op">&lt;</span><span class="st"> </span>.<span class="dv">4</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pander</span>(<span class="dt">caption=</span><span class="st">&quot;Subset of contrasts, showing the break between significant and ns results, as determined by an FDR of 10%.&quot;</span>, <span class="dt">split.tables=</span><span class="ot">Inf</span>)</code></pre></div>
<table>
<caption>Subset of contrasts, showing the break between significant and ns results, as determined by an FDR of 10%.</caption>
<colgroup>
<col width="18%" />
<col width="18%" />
<col width="11%" />
<col width="16%" />
<col width="17%" />
<col width="17%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">level1</th>
<th align="center">level2</th>
<th align="center">p.value</th>
<th align="center">q (10% FDR)</th>
<th align="center">p.fdr.adjust</th>
<th align="center">significant</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Older,Rhyming</td>
<td align="center">Young,Adjective</td>
<td align="center">0.008667</td>
<td align="center">0.07111</td>
<td align="center">0.01219</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">Older,Adjective</td>
<td align="center">Young,Intention</td>
<td align="center">0.02964</td>
<td align="center">0.07333</td>
<td align="center">0.03923</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">Older,Adjective</td>
<td align="center">Older,Imagery</td>
<td align="center">0.02964</td>
<td align="center">0.07556</td>
<td align="center">0.03923</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">Young,Adjective</td>
<td align="center">Young,Imagery</td>
<td align="center">0.06139</td>
<td align="center">0.07778</td>
<td align="center">0.07893</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">Older,Imagery</td>
<td align="center">Older,Intention</td>
<td align="center">0.183</td>
<td align="center">0.08</td>
<td align="center">0.2288</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">Older,Adjective</td>
<td align="center">Young,Imagery</td>
<td align="center">0.2721</td>
<td align="center">0.08222</td>
<td align="center">0.3222</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">Young,Imagery</td>
<td align="center">Young,Intention</td>
<td align="center">0.2721</td>
<td align="center">0.08444</td>
<td align="center">0.3222</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<p>Note, that when you use <code>adjust='fdr'</code> then the p values returned are The <a href="http://www.biostathandbook.com/multiplecomparisons.html">Biostat Handbook</a> has a good</p>
</div>
</div>
<div id="repeated-measures-or-split-plot-designs" class="section level2">
<h2><span class="header-section-number">12.2</span> Repeated measures or ‘split plot’ designs</h2>
<p>It might be controversial to say so, but the tools to run traditional repeat measures Anova in R are a pain to use. It’s not easy to run repeated measures Anova models using base packages alone and, although there are numerous packages which do simplify this a little, their syntax can be obtuse or confusing, and the output sometimes cryptic. To make matters worse, various textbooks, online guides and the R help files themselves show many ways to achieve the same ends, and it can be difficult to follow the differences between the underlying models that are run.</p>
<p>At this point, given the <a href="http://jamanetwork.com/journals/jamapsychiatry/article-abstract/481967">many other advantages of linear mixed models over traditional repeated measures Anova</a>, and given that many researchers abuse traditional Anova in practice (e.g. using it for unbalanced data, or where some data are missing), the recommendation here is to simply give up and learn how to run linear mixed models. These can (very closely) replicate traditional Anova approaches, but also:</p>
<ul>
<li><p>Handle missing data or unbalanced designs gracefully and efficiently.</p></li>
<li><p>Be expanded to include multiple levels of nesting. For example, allowing pupils to be nested within classes, within schools. Alternatively multiple measurements of individual patients might be clustered by hospital or therapist.</p></li>
<li><p>Allow time to be treated as a continuous variable. For example, time can be modelled as a slope or some kind of curve, rather than a fixed set of observation-points. This can be more parsimonious, and more flexible when dealing with real-world data (e.g. from clinical trials).</p></li>
</ul>
<p>It would be best at this point to <a href="multilevel-models.html">jump straight to the main section multilevel or mixed-effects models</a>, but to give one brief example of mixed models in use:</p>
<p>The <code>sleepstudy</code> dataset in the <code>lme4</code> package provides reaction time data recorded from participants over a period of 10 days, during which time they were deprived of sleep.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lme4<span class="op">::</span>sleepstudy <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span>pander</code></pre></div>
<table style="width:38%;">
<colgroup>
<col width="15%" />
<col width="9%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Reaction</th>
<th align="center">Days</th>
<th align="center">Subject</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">249.6</td>
<td align="center">0</td>
<td align="center">308</td>
</tr>
<tr class="even">
<td align="center">258.7</td>
<td align="center">1</td>
<td align="center">308</td>
</tr>
<tr class="odd">
<td align="center">250.8</td>
<td align="center">2</td>
<td align="center">308</td>
</tr>
<tr class="even">
<td align="center">321.4</td>
<td align="center">3</td>
<td align="center">308</td>
</tr>
<tr class="odd">
<td align="center">356.9</td>
<td align="center">4</td>
<td align="center">308</td>
</tr>
<tr class="even">
<td align="center">414.7</td>
<td align="center">5</td>
<td align="center">308</td>
</tr>
<tr class="odd">
<td align="center">382.2</td>
<td align="center">6</td>
<td align="center">308</td>
</tr>
<tr class="even">
<td align="center">290.1</td>
<td align="center">7</td>
<td align="center">308</td>
</tr>
<tr class="odd">
<td align="center">430.6</td>
<td align="center">8</td>
<td align="center">308</td>
</tr>
<tr class="even">
<td align="center">466.4</td>
<td align="center">9</td>
<td align="center">308</td>
</tr>
<tr class="odd">
<td align="center">222.7</td>
<td align="center">0</td>
<td align="center">309</td>
</tr>
<tr class="even">
<td align="center">205.3</td>
<td align="center">1</td>
<td align="center">309</td>
</tr>
</tbody>
</table>
<p>We can plot these data to show the increase in RT as sleep deprivation continues:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lme4<span class="op">::</span>sleepstudy <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="kw">factor</span>(Days), Reaction)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Days&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;RT (ms)&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_label</span>(<span class="kw">aes</span>(<span class="dt">y=</span><span class="dv">400</span>, <span class="dt">x=</span><span class="dv">2</span>, <span class="dt">label=</span><span class="st">&quot;you start to</span><span class="ch">\n</span><span class="st">feel bad here&quot;</span>), <span class="dt">color=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_label</span>(<span class="kw">aes</span>(<span class="dt">y=</span><span class="dv">450</span>, <span class="dt">x=</span><span class="dv">9</span>, <span class="dt">label=</span><span class="st">&quot;imagine how bad</span><span class="ch">\n</span><span class="st">you feel by this point&quot;</span>), <span class="dt">color=</span><span class="st">&quot;red&quot;</span>) </code></pre></div>
<p><img src="anova-cookbook_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>If we want to test whether there are significant differences in RTs between <code>Days</code>, we could fit something very similar to a traditional repeat measures Anova using the <code>lme4::lmer()</code> function, and obtain an Anova table for the model using the special <code>lmerTest::anova()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sleep.model &lt;-<span class="st"> </span><span class="kw">lmer</span>(Reaction <span class="op">~</span><span class="st"> </span><span class="kw">factor</span>(Days) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Subject), <span class="dt">data=</span>lme4<span class="op">::</span>sleepstudy)
lmerTest<span class="op">::</span><span class="kw">anova</span>(sleep.model)
## Analysis of Variance Table of type III  with  Satterthwaite 
## approximation for degrees of freedom
##              Sum Sq Mean Sq NumDF DenDF F.value    Pr(&gt;F)    
## factor(Days) 166235   18471     9   153  18.703 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre></div>
<p>If you had really wanted to fit the traditional repeated measures Anova, the closest equivalent would be:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">afex<span class="op">::</span><span class="kw">aov_car</span>(Reaction <span class="op">~</span><span class="st"> </span>Days <span class="op">+</span><span class="st"> </span><span class="kw">Error</span>(Subject<span class="op">/</span>(Days)), <span class="dt">data=</span>lme4<span class="op">::</span>sleepstudy)
## Anova Table (Type 3 tests)
## 
## Response: Reaction
##   Effect          df     MSE         F ges p.value
## 1   Days 3.32, 56.46 2676.18 18.70 *** .29  &lt;.0001
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;+&#39; 0.1 &#39; &#39; 1
## 
## Sphericity correction method: GG</code></pre></div>
<p>This gives almost-identical results. You may find that in other cases the <code>lmer</code> and traditional anova models diverge slightly, but this is likely to be caused by factors including imbalances in the data, partially missing data (only complete cases can be analyses by traditional anova) or other violations of the assumptions of one or both of the models. There is no clear steer in the literature as to which model is ‘best’ in the general sense, and it is likely that the linear model will be a better fit for a greater range of datasets.</p>
<p>See the <a href="multilevel-models.html">multilevel models section</a> for details of more interesting models using this dataset which:</p>
<ul>
<li>Fit a simple slope for <code>Days</code></li>
<li>Fit curves or other functions for <code>Days</code></li>
<li>Allow the effect of sleep deprivation to vary for different participants</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="anova.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="understanding-interactions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["Just enough R.pdf", "Just enough R.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
