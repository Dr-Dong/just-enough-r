<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Just Enough R</title>
  <meta name="description" content="Just Enough R">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Just Enough R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Just Enough R" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="graphics-approaches.html">
<link rel="next" href="utility-plotting-functions.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Commenting and annotation script -->
<script src="https://hypothes.is/embed.js" async></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-118343766-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-118343766-1');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Just enough R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="part"><span><b>I Getting started</b></span></li>
<li class="chapter" data-level="1" data-path="r-basics.html"><a href="r-basics.html"><i class="fa fa-check"></i><b>1</b> Working with R</a><ul>
<li class="chapter" data-level="" data-path="installation-intro.html"><a href="installation-intro.html"><i class="fa fa-check"></i>Installation</a></li>
<li class="chapter" data-level="" data-path="start-here.html"><a href="start-here.html"><i class="fa fa-check"></i>Workflow</a><ul>
<li class="chapter" data-level="" data-path="start-here.html"><a href="start-here.html#rmarkdown"><i class="fa fa-check"></i>RMarkdown</a></li>
<li class="chapter" data-level="" data-path="start-here.html"><a href="start-here.html#rstudio"><i class="fa fa-check"></i>RStudio</a></li>
<li class="chapter" data-level="" data-path="start-here.html"><a href="start-here.html#creating-code-chunks"><i class="fa fa-check"></i>Creating code chunks</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="first-commands.html"><a href="first-commands.html"><i class="fa fa-check"></i>First commands</a></li>
<li class="chapter" data-level="" data-path="variables.html"><a href="variables.html"><i class="fa fa-check"></i>Naming things</a></li>
<li class="chapter" data-level="" data-path="vectors-and-lists.html"><a href="vectors-and-lists.html"><i class="fa fa-check"></i>Vectors and lists</a><ul>
<li class="chapter" data-level="" data-path="vectors-and-lists.html"><a href="vectors-and-lists.html#vector"><i class="fa fa-check"></i>Vectors</a></li>
<li class="chapter" data-level="" data-path="vectors-and-lists.html"><a href="vectors-and-lists.html#access-vector-elements"><i class="fa fa-check"></i>Accessing elements</a></li>
<li class="chapter" data-level="" data-path="vectors-and-lists.html"><a href="vectors-and-lists.html#selecting-more-than-one-element"><i class="fa fa-check"></i>Selecting more than one element</a></li>
<li class="chapter" data-level="" data-path="vectors-and-lists.html"><a href="vectors-and-lists.html#making-sequences"><i class="fa fa-check"></i>Making and slicing with sequences</a></li>
<li class="chapter" data-level="" data-path="vectors-and-lists.html"><a href="vectors-and-lists.html#conditional-slices"><i class="fa fa-check"></i>Conditional slicing</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="working-with-vectors.html"><a href="working-with-vectors.html"><i class="fa fa-check"></i>Working with vectors</a><ul>
<li class="chapter" data-level="" data-path="working-with-vectors.html"><a href="working-with-vectors.html#making-new-vectors"><i class="fa fa-check"></i>Making new vectors</a></li>
<li class="chapter" data-level="" data-path="working-with-vectors.html"><a href="working-with-vectors.html#making-up-data-new-vectors"><i class="fa fa-check"></i>Making up data (new vectors)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="functions-to-learn-now.html"><a href="functions-to-learn-now.html"><i class="fa fa-check"></i>Functions to learn now</a></li>
<li class="chapter" data-level="" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i>Packages</a></li>
</ul></li>
<li class="part"><span><b>II Data</b></span></li>
<li class="chapter" data-level="2" data-path="datasets-dataframes.html"><a href="datasets-dataframes.html"><i class="fa fa-check"></i><b>2</b> Datasets and dataframes</a><ul>
<li class="chapter" data-level="" data-path="looking-at-data.html"><a href="looking-at-data.html"><i class="fa fa-check"></i>Looking at data</a><ul>
<li class="chapter" data-level="" data-path="looking-at-data.html"><a href="looking-at-data.html#using-individual-columns"><i class="fa fa-check"></i>Using individual columns</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html"><i class="fa fa-check"></i>Working with dataframes</a><ul>
<li><a href="working-with-dataframes.html#tidyverse">Introducing the <code>tidyverse</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="selecting-columns.html"><a href="selecting-columns.html"><i class="fa fa-check"></i>Selecting columns</a></li>
<li class="chapter" data-level="" data-path="selecting-rows.html"><a href="selecting-rows.html"><i class="fa fa-check"></i>Selecting rows</a></li>
<li class="chapter" data-level="" data-path="operators.html"><a href="operators.html"><i class="fa fa-check"></i>‘Operators’</a></li>
<li class="chapter" data-level="" data-path="sorting.html"><a href="sorting.html"><i class="fa fa-check"></i>Sorting</a></li>
<li class="chapter" data-level="" data-path="pipes.html"><a href="pipes.html"><i class="fa fa-check"></i>Pipes</a></li>
<li class="chapter" data-level="" data-path="mutate.html"><a href="mutate.html"><i class="fa fa-check"></i>Modifying and creating new columns</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="real-data.html"><a href="real-data.html"><i class="fa fa-check"></i><b>3</b> ‘Real’ data</a><ul>
<li class="chapter" data-level="" data-path="importing-data.html"><a href="importing-data.html"><i class="fa fa-check"></i>Importing data</a><ul>
<li class="chapter" data-level="" data-path="importing-data.html"><a href="importing-data.html#importing-data-from-the-web"><i class="fa fa-check"></i>Importing data over the web</a></li>
<li class="chapter" data-level="" data-path="importing-data.html"><a href="importing-data.html#importing-proprietary-formats"><i class="fa fa-check"></i>Importing from SPSS and other packages</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="saving-and-exporting.html"><a href="saving-and-exporting.html"><i class="fa fa-check"></i>Saving and exporting</a><ul>
<li class="chapter" data-level="" data-path="saving-and-exporting.html"><a href="saving-and-exporting.html#use-csv"><i class="fa fa-check"></i>Use CSV files</a></li>
<li class="chapter" data-level="" data-path="saving-and-exporting.html"><a href="saving-and-exporting.html#archiving-publication-and-sharing"><i class="fa fa-check"></i>Archiving, publication and sharing</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multiple-raw-data-files.html"><a href="multiple-raw-data-files.html"><i class="fa fa-check"></i>Dealing with multiple files</a></li>
<li class="chapter" data-level="" data-path="joining-data.html"><a href="joining-data.html"><i class="fa fa-check"></i>Joining different datasets</a></li>
<li class="chapter" data-level="" data-path="factors-and-numerics.html"><a href="factors-and-numerics.html"><i class="fa fa-check"></i>Types of variable</a><ul>
<li><a href="factors-and-numerics.html#diffsinquantity">Differences in <em>quantity</em>: numeric variables</a></li>
<li><a href="factors-and-numerics.html#character-and-factor">Differences in <em>quality or kind</em></a></li>
<li class="chapter" data-level="" data-path="factors-and-numerics.html"><a href="factors-and-numerics.html#facsforcategs"><i class="fa fa-check"></i>Factors for categorical data</a></li>
<li class="chapter" data-level="" data-path="factors-and-numerics.html"><a href="factors-and-numerics.html#storingdates"><i class="fa fa-check"></i>Dates</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="missingvalues.html"><a href="missingvalues.html"><i class="fa fa-check"></i>Missing values</a></li>
<li class="chapter" data-level="" data-path="tidyingdata.html"><a href="tidyingdata.html"><i class="fa fa-check"></i>Tidying data</a></li>
<li class="chapter" data-level="" data-path="reshaping.html"><a href="reshaping.html"><i class="fa fa-check"></i>Reshaping</a><ul>
<li class="chapter" data-level="" data-path="reshaping.html"><a href="reshaping.html#which-reshape-package"><i class="fa fa-check"></i>Which package should you use to reshape data?</a></li>
<li class="chapter" data-level="" data-path="reshaping.html"><a href="reshaping.html#aggregating-and-reshaping-at-the-same-time"><i class="fa fa-check"></i>Aggregating and reshaping at the same time</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="summarising-data.html"><a href="summarising-data.html"><i class="fa fa-check"></i><b>4</b> Summaries</a><ul>
<li class="chapter" data-level="" data-path="quick-and-dirty.html"><a href="quick-and-dirty.html"><i class="fa fa-check"></i>“Quick and dirty”</a><ul>
<li class="chapter" data-level="" data-path="quick-and-dirty.html"><a href="quick-and-dirty.html#frequency-tables"><i class="fa fa-check"></i>Frequency tables</a></li>
<li class="chapter" data-level="" data-path="quick-and-dirty.html"><a href="quick-and-dirty.html#summary-statistics"><i class="fa fa-check"></i>Summary statistics</a></li>
<li class="chapter" data-level="" data-path="quick-and-dirty.html"><a href="quick-and-dirty.html#creating-a-data-frame-of-summary-statistics"><i class="fa fa-check"></i>Creating a data frame of summary statistics</a></li>
<li class="chapter" data-level="" data-path="quick-and-dirty.html"><a href="quick-and-dirty.html#computing-statistics-by-groups"><i class="fa fa-check"></i>Computing statistics by-groups</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="a-generalised-approach.html"><a href="a-generalised-approach.html"><i class="fa fa-check"></i>A generalised approach</a><ul>
<li class="chapter" data-level="" data-path="a-generalised-approach.html"><a href="a-generalised-approach.html#fancy-reshaping"><i class="fa fa-check"></i>Fancy reshaping</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="graphics.html"><a href="graphics.html"><i class="fa fa-check"></i><b>5</b> Graphics</a><ul>
<li class="chapter" data-level="" data-path="graphics-benefits.html"><a href="graphics-benefits.html"><i class="fa fa-check"></i>Benefits of visualising data</a></li>
<li class="chapter" data-level="" data-path="graphics-approaches.html"><a href="graphics-approaches.html"><i class="fa fa-check"></i>Which tool to use?</a></li>
<li><a href="layered-graphics.html#layered-graphics">Layered graphics with <code>ggplot</code></a><ul>
<li class="chapter" data-level="" data-path="layered-graphics.html"><a href="layered-graphics.html"><i class="fa fa-check"></i>A thought on ‘chart chooser’ guides</a></li>
<li><a href="layered-graphics.html#thinking-like-ggplot">Thinking like <code>ggplot</code></a></li>
<li class="chapter" data-level="" data-path="layered-graphics.html"><a href="layered-graphics.html#relationships"><i class="fa fa-check"></i>‘Relationships’</a></li>
<li class="chapter" data-level="" data-path="layered-graphics.html"><a href="layered-graphics.html#distributions"><i class="fa fa-check"></i>‘Distributions’</a></li>
<li class="chapter" data-level="" data-path="layered-graphics.html"><a href="layered-graphics.html#comparisons"><i class="fa fa-check"></i>‘Comparisons’</a></li>
<li class="chapter" data-level="" data-path="layered-graphics.html"><a href="layered-graphics.html#composition"><i class="fa fa-check"></i>‘Composition’</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="utility-plotting-functions.html"><a href="utility-plotting-functions.html"><i class="fa fa-check"></i>‘Quick and dirty’ (utility) plots</a><ul>
<li class="chapter" data-level="5.0.1" data-path="utility-plotting-functions.html"><a href="utility-plotting-functions.html#distributions-1"><i class="fa fa-check"></i><b>5.0.1</b> Distributions</a></li>
<li class="chapter" data-level="5.0.2" data-path="utility-plotting-functions.html"><a href="utility-plotting-functions.html#relationships-1"><i class="fa fa-check"></i><b>5.0.2</b> Relationships</a></li>
<li class="chapter" data-level="5.0.3" data-path="utility-plotting-functions.html"><a href="utility-plotting-functions.html#quantities"><i class="fa fa-check"></i><b>5.0.3</b> Quantities</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ggplot-details.html"><a href="ggplot-details.html"><i class="fa fa-check"></i>Tricks with ggplot</a><ul>
<li class="chapter" data-level="" data-path="ggplot-details.html"><a href="ggplot-details.html#facetting-plots"><i class="fa fa-check"></i>More ways to facet a plot</a></li>
<li><a href="ggplot-details.html#facet_wrap"><code>facet_wrap</code></a></li>
<li><a href="ggplot-details.html#facet_grid"><code>facet_grid</code></a></li>
<li class="chapter" data-level="" data-path="ggplot-details.html"><a href="ggplot-details.html#combining-plots"><i class="fa fa-check"></i>Combining separate plots in a grid</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="exporting-graphics.html"><a href="exporting-graphics.html"><i class="fa fa-check"></i>Exporting for print</a></li>
</ul></li>
<li class="part"><span><b>III Models</b></span></li>
<li class="chapter" data-level="6" data-path="common-stats.html"><a href="common-stats.html"><i class="fa fa-check"></i><b>6</b> Commonly used statistics</a><ul>
<li><a href="crosstabs.html#crosstabs">Crosstabulations and <span class="math inline">\(\chi^2\)</span></a><ul>
<li class="chapter" data-level="" data-path="crosstabs.html"><a href="crosstabs.html"><i class="fa fa-check"></i>Three-way tables</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="correlations.html"><a href="correlations.html"><i class="fa fa-check"></i>Correlations</a><ul>
<li class="chapter" data-level="" data-path="correlations.html"><a href="correlations.html#correlation-matrix"><i class="fa fa-check"></i>Creating a correlation matrix</a></li>
<li class="chapter" data-level="" data-path="correlations.html"><a href="correlations.html#working-with-correlation-matrices"><i class="fa fa-check"></i>Working with correlation matrices</a></li>
<li class="chapter" data-level="" data-path="correlations.html"><a href="correlations.html#correlation-tables-for-publication"><i class="fa fa-check"></i>Tables for publication</a></li>
<li class="chapter" data-level="" data-path="correlations.html"><a href="correlations.html#correlation-methods"><i class="fa fa-check"></i>Other methods for correlation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="t-tests.html"><a href="t-tests.html"><i class="fa fa-check"></i>t-tests</a><ul>
<li class="chapter" data-level="" data-path="t-tests.html"><a href="t-tests.html#visualising-your-data-first"><i class="fa fa-check"></i>Visualising your data first</a></li>
<li class="chapter" data-level="" data-path="t-tests.html"><a href="t-tests.html#running-a-t-test"><i class="fa fa-check"></i>Running a t-test</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="linear-models-simple.html"><a href="linear-models-simple.html"><i class="fa fa-check"></i><b>7</b> Regression</a><ul>
<li class="chapter" data-level="" data-path="linear-models-simple.html"><a href="linear-models-simple.html#formulae"><i class="fa fa-check"></i>Describing statistical models using formulae</a></li>
<li class="chapter" data-level="" data-path="linear-models-simple.html"><a href="linear-models-simple.html#running-a-linear-model"><i class="fa fa-check"></i>Running a linear model</a></li>
<li class="chapter" data-level="" data-path="linear-models-simple.html"><a href="linear-models-simple.html#more-on-formulas"><i class="fa fa-check"></i>More on formulas</a></li>
<li class="chapter" data-level="" data-path="factors-and-variable-codings.html"><a href="factors-and-variable-codings.html"><i class="fa fa-check"></i>Factors and variable codings</a></li>
<li class="chapter" data-level="" data-path="parameterisation.html"><a href="parameterisation.html"><i class="fa fa-check"></i>Model specification</a><ul>
<li class="chapter" data-level="" data-path="parameterisation.html"><a href="parameterisation.html#regression-coding"><i class="fa fa-check"></i>Effect/dummy coding and contrasts</a></li>
<li class="chapter" data-level="" data-path="parameterisation.html"><a href="parameterisation.html#centering"><i class="fa fa-check"></i>Centering (is often helpful)</a></li>
<li class="chapter" data-level="" data-path="parameterisation.html"><a href="parameterisation.html#scaling-regression-inputs"><i class="fa fa-check"></i>Scaling inputs</a></li>
<li class="chapter" data-level="" data-path="parameterisation.html"><a href="parameterisation.html#alternatives-to-rescaling"><i class="fa fa-check"></i>Alternatives to rescaling</a></li>
<li class="chapter" data-level="" data-path="parameterisation.html"><a href="parameterisation.html#what-next"><i class="fa fa-check"></i>What next</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="anova.html"><a href="anova.html"><i class="fa fa-check"></i><b>8</b> Anova</a><ul>
<li class="chapter" data-level="" data-path="anova.html"><a href="anova.html#rules-for-using-anova-in-r"><i class="fa fa-check"></i>Rules for using Anova in R</a></li>
<li class="chapter" data-level="" data-path="anova.html"><a href="anova.html#anova-recommendations"><i class="fa fa-check"></i>Recommendations for doing Anova</a></li>
<li class="chapter" data-level="" data-path="anova-cookbook.html"><a href="anova-cookbook.html"><i class="fa fa-check"></i>Anova ‘Cookbook’</a><ul>
<li class="chapter" data-level="" data-path="anova-cookbook.html"><a href="anova-cookbook.html#between-subjects-anova"><i class="fa fa-check"></i>Between-subjects Anova</a></li>
<li class="chapter" data-level="" data-path="anova-cookbook.html"><a href="anova-cookbook.html#repeated-measures"><i class="fa fa-check"></i>Repeated measures or ‘split plot’ designs</a></li>
<li class="chapter" data-level="" data-path="anova-cookbook.html"><a href="anova-cookbook.html#trad-rm-anova"><i class="fa fa-check"></i>Traditional repeated measures Anova</a></li>
<li class="chapter" data-level="" data-path="anova-cookbook.html"><a href="anova-cookbook.html#comparison-with-a-multilevel-model"><i class="fa fa-check"></i>Comparison with a multilevel model</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="checking-assumptions.html"><a href="checking-assumptions.html"><i class="fa fa-check"></i>Checking assumptions</a></li>
<li class="chapter" data-level="" data-path="followup-tests.html"><a href="followup-tests.html"><i class="fa fa-check"></i>Followup tests</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html"><i class="fa fa-check"></i><b>9</b> Generalized linear models</a><ul>
<li class="chapter" data-level="" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#logistic-regression"><i class="fa fa-check"></i>Logistic regression</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="multilevel-models.html"><a href="multilevel-models.html"><i class="fa fa-check"></i><b>10</b> Multilevel models</a><ul>
<li class="chapter" data-level="" data-path="fitting-models.html"><a href="fitting-models.html"><i class="fa fa-check"></i>Fitting multilevel models in R</a><ul>
<li><a href="fitting-models.html#use-lmer-and-glmer">Use <code>lmer</code> and <code>glmer</code></a></li>
<li><a href="fitting-models.html#p-values-in-multilevel-models"><em>p</em> values in multilevel models</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="extending-traditional-rm-anova.html"><a href="extending-traditional-rm-anova.html"><i class="fa fa-check"></i>Extending traditional RM Anova</a><ul>
<li><a href="extending-traditional-rm-anova.html#fit-a-simple-slope-for-days">Fit a simple slope for <code>Days</code></a></li>
<li class="chapter" data-level="" data-path="extending-traditional-rm-anova.html"><a href="extending-traditional-rm-anova.html#allow-the-effect-of-sleep-deprivation-to-vary-for-different-participants"><i class="fa fa-check"></i>Allow the effect of sleep deprivation to vary for different participants</a></li>
<li><a href="extending-traditional-rm-anova.html#growth-curve-sleep-example">Fitting a curve for the effect of <code>Days</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="icc-and-vpc.html"><a href="icc-and-vpc.html"><i class="fa fa-check"></i>Variance partition coefficients and intraclass correlations</a></li>
<li class="chapter" data-level="" data-path="threelevel.html"><a href="threelevel.html"><i class="fa fa-check"></i>3 level models with ‘partially crossed’ random effects</a></li>
<li><a href="contrasts-lmer.html#contrasts-lmer">Contrasts and followup tests using <code>lmer</code></a></li>
<li class="chapter" data-level="" data-path="troubleshooting-multilevel-models.html"><a href="troubleshooting-multilevel-models.html"><i class="fa fa-check"></i>Troubleshooting</a><ul>
<li class="chapter" data-level="" data-path="troubleshooting-multilevel-models.html"><a href="troubleshooting-multilevel-models.html#simplifying-mixed-models"><i class="fa fa-check"></i>Convergence problems and simplifying the random effects structure</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multilevel-bayes-reasons.html"><a href="multilevel-bayes-reasons.html"><i class="fa fa-check"></i>Bayesian multilevel models</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="mediation-and-covariance-modelling.html"><a href="mediation-and-covariance-modelling.html"><i class="fa fa-check"></i><b>11</b> Mediation and covariance modelling</a><ul>
<li class="chapter" data-level="" data-path="mediation.html"><a href="mediation.html"><i class="fa fa-check"></i>Mediation</a><ul>
<li class="chapter" data-level="" data-path="mediation.html"><a href="mediation.html#mediation-with-multiple-regression"><i class="fa fa-check"></i>Mediation with multiple regression</a></li>
<li class="chapter" data-level="" data-path="mediation.html"><a href="mediation.html#mediation-steps"><i class="fa fa-check"></i>Mediation Steps</a></li>
<li class="chapter" data-level="" data-path="mediation.html"><a href="mediation.html#mediation-example-after-baron-and-kenny"><i class="fa fa-check"></i>Mediation example after Baron and Kenny</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="testing-the-indirect-effect.html"><a href="testing-the-indirect-effect.html"><i class="fa fa-check"></i>Testing the indirect effect</a></li>
<li class="chapter" data-level="11.1" data-path="mediation-using-path-models.html"><a href="mediation-using-path-models.html"><i class="fa fa-check"></i><b>11.1</b> Mediation using Path models</a></li>
<li class="chapter" data-level="" data-path="covariance-modelling.html"><a href="covariance-modelling.html"><i class="fa fa-check"></i>Covariance modelling</a></li>
<li class="chapter" data-level="" data-path="path-models.html"><a href="path-models.html"><i class="fa fa-check"></i>Path models</a><ul>
<li class="chapter" data-level="" data-path="path-models.html"><a href="path-models.html#defining-a-model"><i class="fa fa-check"></i>Defining a model</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cfa.html"><a href="cfa.html"><i class="fa fa-check"></i>Confirmatory factor analysis (CFA)</a><ul>
<li class="chapter" data-level="" data-path="cfa.html"><a href="cfa.html#latent-variables"><i class="fa fa-check"></i>Latent variables</a></li>
<li class="chapter" data-level="" data-path="cfa.html"><a href="cfa.html#defining-a-cfa-model"><i class="fa fa-check"></i>Defining a CFA model</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="model-fit.html"><a href="model-fit.html"><i class="fa fa-check"></i>CFA model fit</a></li>
<li class="chapter" data-level="" data-path="modification-indices.html"><a href="modification-indices.html"><i class="fa fa-check"></i>Modification indices</a></li>
<li class="chapter" data-level="" data-path="model-improvement.html"><a href="model-improvement.html"><i class="fa fa-check"></i>Model modification and improvement</a></li>
<li class="chapter" data-level="" data-path="sem.html"><a href="sem.html"><i class="fa fa-check"></i>Structural eqution modelling (SEM)</a></li>
<li class="chapter" data-level="" data-path="identification.html"><a href="identification.html"><i class="fa fa-check"></i>‘Identification’ in CFA and SEM</a></li>
<li class="chapter" data-level="" data-path="cfa-sem-missing-data.html"><a href="cfa-sem-missing-data.html"><i class="fa fa-check"></i>Missing data</a></li>
<li class="chapter" data-level="" data-path="gof.html"><a href="gof.html"><i class="fa fa-check"></i>Goodness of fit statistics in CFA</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="bayes-mcmc.html"><a href="bayes-mcmc.html"><i class="fa fa-check"></i><b>12</b> Baysian model fitting</a><ul>
<li class="chapter" data-level="" data-path="bayes-mcmc.html"><a href="bayes-mcmc.html#baysian-fitting-of-linear-models-via-mcmc-methods"><i class="fa fa-check"></i>Baysian fitting of linear models via MCMC methods</a></li>
<li class="chapter" data-level="" data-path="bayes-mcmc.html"><a href="bayes-mcmc.html#posterior-probabilities-for-parameters"><i class="fa fa-check"></i>Posterior probabilities for parameters</a></li>
<li class="chapter" data-level="" data-path="bayes-mcmc.html"><a href="bayes-mcmc.html#credible-intervals"><i class="fa fa-check"></i>Credible intervals</a></li>
<li class="chapter" data-level="" data-path="bayes-mcmc.html"><a href="bayes-mcmc.html#bayesian-p-values-for-parameters"><i class="fa fa-check"></i>Bayesian ‘p values’ for parameters</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="power-analysis.html"><a href="power-analysis.html"><i class="fa fa-check"></i><b>13</b> Power analysis</a><ul>
<li class="chapter" data-level="" data-path="power-analysis.html"><a href="power-analysis.html#for-most-inferential-statistics"><i class="fa fa-check"></i>For most inferential statistics</a></li>
<li class="chapter" data-level="" data-path="power-analysis.html"><a href="power-analysis.html#for-multilevel-or-generalised-linear-models"><i class="fa fa-check"></i>For multilevel or generalised linear models</a></li>
</ul></li>
<li class="part"><span><b>IV Patterns</b></span></li>
<li class="chapter" data-level="14" data-path="learning-key-patterns.html"><a href="learning-key-patterns.html"><i class="fa fa-check"></i><b>14</b> Learning key patterns</a></li>
<li class="chapter" data-level="15" data-path="understanding-interactions.html"><a href="understanding-interactions.html"><i class="fa fa-check"></i><b>15</b> Unpicking interactions</a><ul>
<li class="chapter" data-level="" data-path="understanding-interactions.html"><a href="understanding-interactions.html#what-is-an-interaction"><i class="fa fa-check"></i>What is an interaction?</a></li>
<li class="chapter" data-level="" data-path="understanding-interactions.html"><a href="understanding-interactions.html#visualising-interactions-from-raw-data"><i class="fa fa-check"></i>Visualising interactions from raw data</a></li>
<li class="chapter" data-level="" data-path="understanding-interactions.html"><a href="understanding-interactions.html#pain-music-data"><i class="fa fa-check"></i>A painful example</a></li>
<li class="chapter" data-level="" data-path="understanding-interactions.html"><a href="understanding-interactions.html#continuous-predictors"><i class="fa fa-check"></i>Continuous predictors</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="predictions-and-margins.html"><a href="predictions-and-margins.html"><i class="fa fa-check"></i><b>16</b> Making predictions</a><ul>
<li class="chapter" data-level="" data-path="predictions-and-margins.html"><a href="predictions-and-margins.html#predictions-vs-margins"><i class="fa fa-check"></i>Predictions vs margins</a></li>
<li class="chapter" data-level="" data-path="predictions-and-margins.html"><a href="predictions-and-margins.html#predicted-means"><i class="fa fa-check"></i>Predicted means</a></li>
<li><a href="predictions-and-margins.html#effects-margins"><em>Effects</em> (margins)</a></li>
<li class="chapter" data-level="" data-path="predictions-and-margins.html"><a href="predictions-and-margins.html#continuous-predictors-1"><i class="fa fa-check"></i>Continuous predictors</a></li>
<li><a href="predicted-means-and-margins-using-lm.html#predicted-means-and-margins-using-lm">Predicted means and margins using <code>lm()</code></a><ul>
<li class="chapter" data-level="" data-path="predicted-means-and-margins-using-lm.html"><a href="predicted-means-and-margins-using-lm.html"><i class="fa fa-check"></i>Running the model</a></li>
<li class="chapter" data-level="" data-path="predicted-means-and-margins-using-lm.html"><a href="predicted-means-and-margins-using-lm.html#making-predictions-for-means"><i class="fa fa-check"></i>Making predictions for means</a></li>
<li><a href="predicted-means-and-margins-using-lm.html#making-prdictions-for-margins-effects-of-predictors">Making prdictions for margins (<em>effects</em> of predictors)</a></li>
<li class="chapter" data-level="" data-path="predicted-means-and-margins-using-lm.html"><a href="predicted-means-and-margins-using-lm.html#marginal-effects"><i class="fa fa-check"></i>Marginal effects</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="predictions-with-continuous-covariates.html"><a href="predictions-with-continuous-covariates.html"><i class="fa fa-check"></i>Predictions with continuous covariates</a></li>
<li class="chapter" data-level="" data-path="visualising-interactions.html"><a href="visualising-interactions.html"><i class="fa fa-check"></i>Visualising interactions</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="models-are-data-too.html"><a href="models-are-data-too.html"><i class="fa fa-check"></i><b>17</b> Models are data</a><ul>
<li class="chapter" data-level="" data-path="models-are-data-too.html"><a href="models-are-data-too.html#storing-models-in-variables"><i class="fa fa-check"></i>Storing models in variables</a></li>
<li class="chapter" data-level="" data-path="models-are-data-too.html"><a href="models-are-data-too.html#extract-results-from-models"><i class="fa fa-check"></i>Extracting results from models</a></li>
<li><a href="models-are-data-too.html#poking-around-with-and">‘Poking around’ with <code>$</code> and <code>@</code></a></li>
<li><a href="models-are-data-too.html#broom">Save time: use a <code>broom</code></a></li>
<li class="chapter" data-level="" data-path="process-model-results.html"><a href="process-model-results.html"><i class="fa fa-check"></i>‘Processing’ results</a></li>
<li class="chapter" data-level="" data-path="output-tables.html"><a href="output-tables.html"><i class="fa fa-check"></i>Printing tables</a></li>
<li class="chapter" data-level="" data-path="apa-output.html"><a href="apa-output.html"><i class="fa fa-check"></i>APA formatting for free</a><ul>
<li><a href="apa-output.html#chi2">Chi<sup>2</sup></a></li>
<li class="chapter" data-level="" data-path="apa-output.html"><a href="apa-output.html#t-test"><i class="fa fa-check"></i>T-test</a></li>
<li class="chapter" data-level="" data-path="apa-output.html"><a href="apa-output.html#anova-1"><i class="fa fa-check"></i>Anova</a></li>
<li class="chapter" data-level="" data-path="apa-output.html"><a href="apa-output.html#multilevel-models-1"><i class="fa fa-check"></i>Multilevel models</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="code-reuse.html"><a href="code-reuse.html"><i class="fa fa-check"></i>Simplifying and re-using</a><ul>
<li class="chapter" data-level="" data-path="code-reuse.html"><a href="code-reuse.html#helper-functions"><i class="fa fa-check"></i>Writing helper functions</a></li>
<li><a href="code-reuse.html#ggplot-reuse">Re-using code with <code>ggplot</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="table1.html"><a href="table1.html"><i class="fa fa-check"></i>“Table 1”</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="quirks.html"><a href="quirks.html"><i class="fa fa-check"></i><b>18</b> Dealing with quirks of R</a><ul>
<li class="chapter" data-level="" data-path="rownames.html"><a href="rownames.html"><i class="fa fa-check"></i>Rownames are evil</a></li>
<li class="chapter" data-level="" data-path="string-handling.html"><a href="string-handling.html"><i class="fa fa-check"></i>Working with character strings</a><ul>
<li class="chapter" data-level="18.0.1" data-path="string-handling.html"><a href="string-handling.html#searching-and-replacing"><i class="fa fa-check"></i><b>18.0.1</b> Searching and replacing</a></li>
<li><a href="working-with-vectors.html#paste">Using <code>paste</code> to make labels</a></li>
<li><a href="string-handling.html#separate-and-extract">Fixing up <code>variable</code> after melting</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="colours.html"><a href="colours.html"><i class="fa fa-check"></i>Colours</a><ul>
<li class="chapter" data-level="" data-path="colours.html"><a href="colours.html#picking-colours"><i class="fa fa-check"></i>Picking colours for plots</a></li>
<li class="chapter" data-level="" data-path="colours.html"><a href="colours.html#named-colours"><i class="fa fa-check"></i>Named colours in R</a></li>
<li class="chapter" data-level="" data-path="colours.html"><a href="colours.html#color-brewer"><i class="fa fa-check"></i>ColourBrewer with ggplot</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="getting-help.html"><a href="getting-help.html"><i class="fa fa-check"></i><b>19</b> Getting help</a><ul>
<li class="chapter" data-level="" data-path="getting-help.html"><a href="getting-help.html#backtick-location"><i class="fa fa-check"></i>Finding the backtick on your keyboard</a></li>
</ul></li>
<li class="part"><span><b>V Explanations</b></span></li>
<li class="chapter" data-level="20" data-path="intervals.html"><a href="intervals.html"><i class="fa fa-check"></i><b>20</b> Confidence and Intervals</a><ul>
<li class="chapter" data-level="" data-path="intervals.html"><a href="intervals.html#the-problem-with-confidence-intervals"><i class="fa fa-check"></i>The problem with confidence intervals</a></li>
<li class="chapter" data-level="" data-path="intervals.html"><a href="intervals.html#forgetting-that-the-ci-depends-on-sample-size."><i class="fa fa-check"></i>Forgetting that the CI depends on sample size.</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="multiple-comparisons.html"><a href="multiple-comparisons.html"><i class="fa fa-check"></i><b>21</b> Multiple comparisons</a><ul>
<li><a href="multiple-comparisons.html#p-values-and-false-discoveries"><em>p</em> values and ‘false discoveries’</a></li>
<li class="chapter" data-level="" data-path="multiple-comparisons.html"><a href="multiple-comparisons.html#multiple-tests-on-the-same-data"><i class="fa fa-check"></i>Multiple tests on the same data</a></li>
<li class="chapter" data-level="" data-path="multiple-comparisons.html"><a href="multiple-comparisons.html#what-to-do-about-it"><i class="fa fa-check"></i>What to do about it?</a></li>
<li class="chapter" data-level="" data-path="multiple-comparisons.html"><a href="multiple-comparisons.html#contrasts-examples"><i class="fa fa-check"></i>Practical examples</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="clustering.html"><a href="clustering.html"><i class="fa fa-check"></i><b>22</b> Non-independence</a></li>
<li class="chapter" data-level="23" data-path="fixed-or-random.html"><a href="fixed-or-random.html"><i class="fa fa-check"></i><b>23</b> Fixed and random effects</a></li>
<li class="chapter" data-level="24" data-path="scaling-predictors.html"><a href="scaling-predictors.html"><i class="fa fa-check"></i><b>24</b> Scaling predictor variables</a><ul>
<li class="chapter" data-level="" data-path="scaling-predictors.html"><a href="scaling-predictors.html#standardizing"><i class="fa fa-check"></i>Standardising</a></li>
<li class="chapter" data-level="" data-path="scaling-predictors.html"><a href="scaling-predictors.html#dichotomising"><i class="fa fa-check"></i>Dichotomising continuous predictors (or outcomes)</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="non-scale-outcomes.html"><a href="non-scale-outcomes.html"><i class="fa fa-check"></i><b>25</b> Non-scale outcomes</a><ul>
<li class="chapter" data-level="25.1" data-path="link-functions.html"><a href="link-functions.html"><i class="fa fa-check"></i><b>25.1</b> Link functions</a><ul>
<li class="chapter" data-level="" data-path="link-functions.html"><a href="link-functions.html#logistic-link-function"><i class="fa fa-check"></i>Logistic regression</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="26" data-path="comparison-and-selection.html"><a href="comparison-and-selection.html"><i class="fa fa-check"></i><b>26</b> Building and choosing models</a><ul>
<li class="chapter" data-level="" data-path="comparison-and-selection.html"><a href="comparison-and-selection.html#like-maps-models-are-imperfect-but-useful"><i class="fa fa-check"></i>Like maps, models are imperfect but useful</a></li>
<li class="chapter" data-level="" data-path="comparison-and-selection.html"><a href="comparison-and-selection.html#over-fitting"><i class="fa fa-check"></i>Overfitting/underfitting</a></li>
<li class="chapter" data-level="" data-path="comparison-and-selection.html"><a href="comparison-and-selection.html#variable-selection"><i class="fa fa-check"></i>Choosing the ‘right variables’</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Just Enough R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="layered-graphics" class="section level2 unnumbered">
<h2>Layered graphics with <code>ggplot</code></h2>
<p>If you’ve never given much thought to data visualisation before, you might be surprised at the sheer variety of graphs types available.</p>
<p>One way to cut through the multitude of options is to determine what the purpose of your plot is. Although not a complete list, it’s likely your plot will show at least one of:</p>
<ul>
<li>Relationships</li>
<li>Distributions</li>
<li>Comparison</li>
<li>Composition</li>
</ul>
<p>The <code>ggplot</code> library makes it easy to produce high quality graphics which serve these ends, and to layer them to produce information-dense plots which are really effective forms of communication.</p>
<div class="figure"><span id="fig:unnamed-chunk-4"></span>
<img src="graphics_files/figure-html/unnamed-chunk-4-1.png" alt="Examples of charts showing comaprisons, relationships, distribution and composition. The comparison, distribution and composition plots show 2 variables, but the relationship plot includes 3, increasing the density of the information displayed. " width="768" />
<p class="caption">
Figure 5.1: Examples of charts showing comaprisons, relationships, distribution and composition. The comparison, distribution and composition plots show 2 variables, but the relationship plot includes 3, increasing the density of the information displayed.
</p>
</div>
<div id="a-thought-on-chart-chooser-guides" class="section level3 unnumbered explainer">
<h3>A thought on ‘chart chooser’ guides</h3>
<p>There are various simple chart selection guides available online, of which these are quite nice examples:</p>
<ul>
<li><a href="http://extremepresentation.typepad.com/blog/2006/09/choosing_a_good.html">Chart selection guide (pdf)</a>]</li>
<li><a href="https://www.perceptualedge.com/articles/misc/Graph_Selection_Matrix.pdf">‘Show me the numbers’ chart guide (pdf)</a></li>
</ul>
<p><img src="media/choosing_a_good_chart.jpg" /></p>
<p><em>However</em>, guides which attempt to be comprehensive and show you a full range of plot types are perhaps not as useful as those which reflect our knowledge of which plots are the most effective forms of communication.</p>
<p>For example, almost all guides to plotting, and especially R textbooks, will show you how to plot a simple bar graph. But bar graphs have numerous disadvantages over other plots which can show the same information.</p>
<p>Specifically, they:</p>
<ul>
<li><p>are low in information density (and so inefficient in use of space)</p></li>
<li><p>make comparisons between multiple data series very difficult (for example in <a href="understanding-interactions.html#understanding-interactions">interaction plots</a>), and</p></li>
<li><p>perhaps most importantly, even when they include error bars, readers consistently misinterpret the quantitative information in bar graphs (specifically, when bar graphs are used to display estimates which contain error, readers assume points above the bar are less likely than points within the bar, even though this is typically not the case).</p></li>
</ul>
<p>You should be guided in choosing plots not by mechanical rules based on the number or type of variables you want to display. Instead, you should be guided by the evidence from basic studies of human perception, and applied data on how different types of infromation displays are really used by readers.</p>
<p>This guide is restricted to examples likely to be useful and effective for experiemental and applied psychologists.</p>
</div>
<div id="thinking-like-ggplot" class="section level3 unnumbered">
<h3>Thinking like <code>ggplot</code></h3>
<p>When using <code>ggplot</code> it helps to think of five separate steps to making a plot (2 are optional, but commonly used):</p>
<ol style="list-style-type: decimal">
<li><p>Choose the data you want to plot.</p></li>
<li><p>Map variables to axes or other features of the plot (e.g. sizes or colours).</p></li>
<li><p>(Optionally) use <code>ggplot</code> functions to summarise your data before the plot is drawn (e.g. to calulate means and standard errors for point-range plots).</p></li>
<li><p>Add visual display layers.</p></li>
<li><p>(Optionally) Split the plot up across multiple panels using groupings in the data.</p></li>
</ol>
<p>You can then customise the plot labels and title, and tweak other presentation parameters, although this often isn’t necessary unless sending a graphic for publication. You can also export graphics in multiple high quality formats.</p>
<p>The simplest way to demonstrate these steps is with an example, and we begin with a plot showing the relationship betwen variables:</p>
</div>
<div id="relationships" class="section level3 unnumbered">
<h3>‘Relationships’</h3>
<p>Problem to be solved: <em>You want to check/show whether variables are related in a linear fashion, e.g. before running linear regression</em></p>
<div id="step-1-select-data-to-plot" class="section level5 unnumbered">
<h5>Step 1: Select data to plot</h5>
<p>Step 1 is to select our data. As is typical in R, <code>ggplot</code> works best with long-format data. In the examples below we will use the <code>mtcars</code> dataset for convenience, so our first line of code is to use the <code>dplyr</code> pipe symbol (operator) to send the <code>mtcars</code> dataset to the next line of code:</p>
<pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>...</code></pre>
</div>
<div id="step-2-map-variables-to-axes-colours-and-other-features" class="section level5 unnumbered">
<h5>Step 2: Map variables to axes, colours, and other features</h5>
<p>Step 2 is to map the variables we want to axes or other features of the plot (e.g. the colours of points, or the linetypes used in line plots).</p>
<p>The specify these mappings we use the <code>aes()</code> function, which is slightly cryptic, but short for ‘aesthetics mapping’. Depending on the plot type you will specify different aesthetics, and they can also have different effects depending on the plot type, but you will commonly specify:</p>
<ul>
<li><code>x</code> the variable to use as the x axis</li>
<li><code>y</code> the variable to use as the y axis</li>
<li><code>colour</code>: the variable to use to colour points or lines</li>
</ul>
<p>Here we tell <code>ggplot</code> to use <code>disp</code> (engine size) on the x axis, and <code>mpg</code> on the y axis. We also tell it to colour the points differently depending on the value of <code>hp</code> (engine horsepower).</p>
<p>At this point <code>ggplot</code> will create and label the axes and plot area, but doesn’t yet display any of our data. For this we need to add visual display layers (in the next step).</p>
<pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> disp, <span class="dt">y =</span> mpg, <span class="dt">colour=</span>hp))</code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<div id="aesthetics" class="section level6 unnumbered explainer">
<h6>Other aesthetics</h6>
<p>There are many other aesthetics which can be specified. Some of the most useful are:</p>
<ul>
<li><code>ymin</code> and <code>ymax</code>: for upper and lower bounds, e.g. on error bars</li>
<li><code>group</code>:which tells ggplot to group observations by some variable and, for example, plot a different line per-group)</li>
<li><code>fill</code>: like <code>colour</code> but for areas/shapes</li>
<li><code>alpha</code> and <code>size</code>: control the size and opacity of visual features (useful for de-emphasising some features of a plot to make others stand out)</li>
</ul>
<p>See the ggplot documentation for more details: <a href="http://ggplot2.tidyverse.org/reference/#section-aesthetics" class="uri">http://ggplot2.tidyverse.org/reference/#section-aesthetics</a></p>
</div>
</div>
<div id="step-3" class="section level5 unnumbered">
<h5>Step 3</h5>
<p>We skip step 3 for this example (asking ggplot to automatically make summaries of our data before plotting), but will cover it below - see the <code>stat_summary()</code> function.</p>
</div>
<div id="step-4-display-data" class="section level5 unnumbered">
<h5>Step 4: Display data</h5>
<p>To display data, we have to add a visual layer to the plot. For example, let’s say we want to make a scatter plot, and so draw points for each row of data:</p>
<pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> disp, <span class="dt">y =</span> mpg, <span class="dt">colour=</span>hp)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>And we have a pretty slick graph: <code>ggplot</code> has now added points for each pair of <code>disp</code> and <code>mpg</code> values, and coloured them according to the value of <code>hp</code> (see <a href="colours.html#picking-colours">choosing colours below</a>).</p>
<p><span class="exercise">Use the <code>airquality</code> dataset and create your own scatterplot and try to colour the points using the <code>Month</code> variable. Should <code>Month</code> be used as a factor or a numeric variable when colouring the points?</span></p>
<p>What’s even neater about <code>ggplot</code> though is how easy it is to <em>layer</em> different visualisations of the same data. These visual layers are called <code>geom</code>’s and the functions which add them are all prefixed with <code>geom_</code>, so <code>geom_point()</code> for scatter plots, or <code>geom_line()</code> for line plots, or <code>geom_smooth()</code> for a smoothed line plot. We can add this to the scatter plot like so:</p>
<pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> disp, <span class="dt">y =</span> mpg, <span class="dt">colour=</span>hp)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se=</span>F, <span class="dt">colour=</span><span class="st">&quot;grey&quot;</span>) 
<span class="st">`</span><span class="dt">geom_smooth()</span><span class="st">`</span> using method =<span class="st"> &#39;loess&#39;</span></code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>In the example above, I have also customised the smoothed line, making it grey to avoid over-intrusion into our perception of the points. Often less is more when plotting graphs: not everything can be emphasised at once, and <em>it’s important to make decisions about what should be given visual priority</em>.</p>
</div>
<div id="step-5-splitting-up-or-repeating-the-plot." class="section level5 unnumbered">
<h5>Step 5: ‘Splitting up’ or repeating the plot.</h5>
<p>Very often, you will have drawn plot and think things like <em>I wonder what that would look like if I drew it for men and women separately?</em>. In <code>ggplot</code> this is called facetting, and is easy to achieve, provided your data are in a long format.</p>
<p>Using the same <code>mtcars</code> example, let’s say we wanted separate panels for American vs. Foreign cars (information held in the <code>am</code> variable). We simply add the <code>facet_wrap()</code>, and specify the <code>&quot;am&quot;</code> variable:</p>
<pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> disp, <span class="dt">y =</span> mpg, <span class="dt">colour=</span>hp)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se=</span>F, <span class="dt">colour=</span><span class="st">&quot;grey&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="st">&quot;am&quot;</span>)
<span class="st">`</span><span class="dt">geom_smooth()</span><span class="st">`</span> using method =<span class="st"> &#39;loess&#39;</span></code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>One trick is to make sure factors are labelled nicely, because these labels appear on the final plot. Here the <code>mutate()</code> call <a href="real-data.html#factors-and-numerics">relabels the factor</a> which makes the plot easier to read:</p>
<pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">american =</span> <span class="kw">factor</span>(am, <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;American&quot;</span>, <span class="st">&quot;Foreign&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> disp, <span class="dt">y =</span> mpg, <span class="dt">colour=</span>hp)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se=</span>F, <span class="dt">colour=</span><span class="st">&quot;grey&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="st">&quot;american&quot;</span>)
<span class="st">`</span><span class="dt">geom_smooth()</span><span class="st">`</span> using method =<span class="st"> &#39;loess&#39;</span></code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p><a href="http://ggplot2.tidyverse.org/reference/#section-facetting">See the ggplot documentation on facetting for more details</a>.</p>
</div>
</div>
<div id="distributions" class="section level3 unnumbered">
<h3>‘Distributions’</h3>
<pre class="sourceCode r"><code class="sourceCode r">lme4<span class="op">::</span>sleepstudy <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Reaction)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>()</code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Imagine we wanted to compare distributions for individuals. Simply overlaying the lines is confusing:</p>
<pre class="sourceCode r"><code class="sourceCode r">lme4<span class="op">::</span>sleepstudy <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Reaction, <span class="dt">group=</span>Subject)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>()</code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Facetting produces a nicer result:</p>
<pre class="sourceCode r"><code class="sourceCode r">lme4<span class="op">::</span>sleepstudy <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Reaction)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="st">&quot;Subject&quot;</span>)</code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>But we could present the same information more compactly, and with better facility to compare between subjects, if we use a bottleplot:</p>
<pre class="sourceCode r"><code class="sourceCode r">lme4<span class="op">::</span>sleepstudy <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Subject, Reaction)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_violin</span>() </code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>We might want to plot our Subjects in order of their mean RT:</p>
<pre class="sourceCode r"><code class="sourceCode r">mean.ranked.sleep &lt;-<span class="st"> </span>lme4<span class="op">::</span>sleepstudy <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(Subject) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># calculate mean RT</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">RTm =</span> <span class="kw">mean</span>(Reaction)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># sort by mean RT</span>
<span class="st">  </span><span class="kw">arrange</span>(RTm, Days) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># create a rank score but conert to factor right away </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">SubjectRank =</span> <span class="kw">factor</span>(<span class="kw">dense_rank</span>(RTm)))

mean.ranked.sleep <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(SubjectRank, Reaction)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_violin</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">aspect.ratio =</span> <span class="fl">.33</span>)  <span class="co"># change the aspect ratio to make long and wide</span></code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Or we might want to compare individuals against the combined distribution:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># duplicate all the data, assigning one-replication to a single subject, &quot;All&quot;</span>
sleep.repeat &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(lme4<span class="op">::</span>sleepstudy,
                          lme4<span class="op">::</span>sleepstudy <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Subject=</span><span class="st">&quot;All&quot;</span>))
Warning <span class="cf">in</span> <span class="kw">bind_rows_</span>(x, .id)<span class="op">:</span><span class="st"> </span>binding factor and character vector,
coercing into character vector
Warning <span class="cf">in</span> <span class="kw">bind_rows_</span>(x, .id)<span class="op">:</span><span class="st"> </span>binding character and factor vector,
coercing into character vector

sleep.repeat <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">all =</span> Subject<span class="op">==</span><span class="st">&quot;All&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Subject, Reaction, <span class="dt">color=</span>all)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_violin</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">colour=</span><span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span><span class="co"># turn off he legend because we don&#39;t really need it</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">aspect.ratio =</span> <span class="fl">.25</span>)  <span class="co"># change the aspect ratio to make long and wide</span></code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Boxplots can also work well to show distributions, and have the advantage of showing the median explicitly:</p>
<pre class="sourceCode r"><code class="sourceCode r">mean.ranked.sleep <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(SubjectRank, Reaction)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() </code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>If we plot the same data by-day, we can clearly see the effect of sleep deprivation, and the increase in variability between subjects as sime goes on: the lack of sleeps seems to be affecting some subjects more than others</p>
<pre class="sourceCode r"><code class="sourceCode r">lme4<span class="op">::</span>sleepstudy <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="kw">factor</span>(Days), Reaction)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() </code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
</div>
<div id="comparisons" class="section level3 unnumbered">
<h3>‘Comparisons’</h3>
<p>Imagine we have rainfall and temperature data for various regions, across months:</p>
<pre class="sourceCode r"><code class="sourceCode r">DAAG<span class="op">::</span>bomregions <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>psych<span class="op">::</span><span class="kw">describe</span>(<span class="dt">fast=</span>T) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>pander</code></pre>
<table>
<colgroup>
<col width="18%" />
<col width="8%" />
<col width="7%" />
<col width="14%" />
<col width="10%" />
<col width="10%" />
<col width="9%" />
<col width="9%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">vars</th>
<th align="center">n</th>
<th align="center">mean</th>
<th align="center">sd</th>
<th align="center">min</th>
<th align="center">max</th>
<th align="center">range</th>
<th align="center">se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>Year</strong></td>
<td align="center">1</td>
<td align="center">109</td>
<td align="center">1954</td>
<td align="center">31.61</td>
<td align="center">1900</td>
<td align="center">2008</td>
<td align="center">108</td>
<td align="center">3.028</td>
</tr>
<tr class="even">
<td align="center"><strong>eastAVt</strong></td>
<td align="center">2</td>
<td align="center">99</td>
<td align="center">20.43</td>
<td align="center">0.4585</td>
<td align="center">19.35</td>
<td align="center">21.61</td>
<td align="center">2.255</td>
<td align="center">0.04608</td>
</tr>
<tr class="odd">
<td align="center"><strong>seAVt</strong></td>
<td align="center">3</td>
<td align="center">99</td>
<td align="center">14.59</td>
<td align="center">0.4547</td>
<td align="center">13.62</td>
<td align="center">15.94</td>
<td align="center">2.32</td>
<td align="center">0.0457</td>
</tr>
<tr class="even">
<td align="center"><strong>southAVt</strong></td>
<td align="center">4</td>
<td align="center">99</td>
<td align="center">18.48</td>
<td align="center">0.4584</td>
<td align="center">17.43</td>
<td align="center">19.53</td>
<td align="center">2.1</td>
<td align="center">0.04607</td>
</tr>
<tr class="odd">
<td align="center"><strong>swAVt</strong></td>
<td align="center">5</td>
<td align="center">99</td>
<td align="center">16.18</td>
<td align="center">0.4734</td>
<td align="center">15.08</td>
<td align="center">17.05</td>
<td align="center">1.97</td>
<td align="center">0.04758</td>
</tr>
<tr class="even">
<td align="center"><strong>westAVt</strong></td>
<td align="center">6</td>
<td align="center">99</td>
<td align="center">22.33</td>
<td align="center">0.4548</td>
<td align="center">21.22</td>
<td align="center">23.39</td>
<td align="center">2.165</td>
<td align="center">0.04571</td>
</tr>
<tr class="odd">
<td align="center"><strong>northAVt</strong></td>
<td align="center">7</td>
<td align="center">99</td>
<td align="center">24.6</td>
<td align="center">0.5042</td>
<td align="center">23.57</td>
<td align="center">25.94</td>
<td align="center">2.365</td>
<td align="center">0.05067</td>
</tr>
<tr class="even">
<td align="center"><strong>mdbAVt</strong></td>
<td align="center">8</td>
<td align="center">99</td>
<td align="center">17.59</td>
<td align="center">0.4958</td>
<td align="center">16.36</td>
<td align="center">18.79</td>
<td align="center">2.425</td>
<td align="center">0.04983</td>
</tr>
<tr class="odd">
<td align="center"><strong>auAVt</strong></td>
<td align="center">9</td>
<td align="center">99</td>
<td align="center">21.71</td>
<td align="center">0.4429</td>
<td align="center">20.67</td>
<td align="center">22.87</td>
<td align="center">2.195</td>
<td align="center">0.04452</td>
</tr>
<tr class="even">
<td align="center"><strong>eastRain</strong></td>
<td align="center">10</td>
<td align="center">109</td>
<td align="center">601.6</td>
<td align="center">123.8</td>
<td align="center">315.3</td>
<td align="center">1030</td>
<td align="center">715</td>
<td align="center">11.85</td>
</tr>
<tr class="odd">
<td align="center"><strong>seRain</strong></td>
<td align="center">11</td>
<td align="center">109</td>
<td align="center">598.1</td>
<td align="center">104.6</td>
<td align="center">354.9</td>
<td align="center">900.6</td>
<td align="center">545.7</td>
<td align="center">10.02</td>
</tr>
<tr class="even">
<td align="center"><strong>southRain</strong></td>
<td align="center">12</td>
<td align="center">109</td>
<td align="center">381.7</td>
<td align="center">68.63</td>
<td align="center">236</td>
<td align="center">618.2</td>
<td align="center">382.1</td>
<td align="center">6.574</td>
</tr>
<tr class="odd">
<td align="center"><strong>swRain</strong></td>
<td align="center">13</td>
<td align="center">109</td>
<td align="center">657.8</td>
<td align="center">103</td>
<td align="center">420.5</td>
<td align="center">988.8</td>
<td align="center">568.4</td>
<td align="center">9.861</td>
</tr>
<tr class="even">
<td align="center"><strong>westRain</strong></td>
<td align="center">14</td>
<td align="center">109</td>
<td align="center">352.2</td>
<td align="center">84.55</td>
<td align="center">173.5</td>
<td align="center">646.5</td>
<td align="center">473</td>
<td align="center">8.098</td>
</tr>
<tr class="odd">
<td align="center"><strong>northRain</strong></td>
<td align="center">15</td>
<td align="center">109</td>
<td align="center">520.7</td>
<td align="center">110.2</td>
<td align="center">312.8</td>
<td align="center">946.9</td>
<td align="center">634</td>
<td align="center">10.55</td>
</tr>
<tr class="even">
<td align="center"><strong>mdbRain</strong></td>
<td align="center">16</td>
<td align="center">109</td>
<td align="center">476</td>
<td align="center">110.9</td>
<td align="center">255.8</td>
<td align="center">821</td>
<td align="center">565.2</td>
<td align="center">10.62</td>
</tr>
<tr class="odd">
<td align="center"><strong>auRain</strong></td>
<td align="center">17</td>
<td align="center">109</td>
<td align="center">457.1</td>
<td align="center">82.55</td>
<td align="center">317.2</td>
<td align="center">785.3</td>
<td align="center">468.1</td>
<td align="center">7.906</td>
</tr>
<tr class="even">
<td align="center"><strong>SOI</strong></td>
<td align="center">18</td>
<td align="center">109</td>
<td align="center">-0.002676</td>
<td align="center">6.845</td>
<td align="center">-20.01</td>
<td align="center">20.79</td>
<td align="center">40.8</td>
<td align="center">0.6556</td>
</tr>
<tr class="odd">
<td align="center"><strong>co2mlo</strong></td>
<td align="center">19</td>
<td align="center">50</td>
<td align="center">345.6</td>
<td align="center">21.01</td>
<td align="center">316</td>
<td align="center">385.4</td>
<td align="center">69.47</td>
<td align="center">2.972</td>
</tr>
<tr class="even">
<td align="center"><strong>co2law</strong></td>
<td align="center">20</td>
<td align="center">79</td>
<td align="center">310.4</td>
<td align="center">9.586</td>
<td align="center">295.8</td>
<td align="center">333.7</td>
<td align="center">37.9</td>
<td align="center">1.078</td>
</tr>
<tr class="odd">
<td align="center"><strong>CO2</strong></td>
<td align="center">21</td>
<td align="center">109</td>
<td align="center">324.3</td>
<td align="center">24.59</td>
<td align="center">296.3</td>
<td align="center">385.4</td>
<td align="center">89.19</td>
<td align="center">2.355</td>
</tr>
<tr class="even">
<td align="center"><strong>sunspot</strong></td>
<td align="center">22</td>
<td align="center">109</td>
<td align="center">60.08</td>
<td align="center">47.69</td>
<td align="center">1.4</td>
<td align="center">190.2</td>
<td align="center">188.8</td>
<td align="center">4.568</td>
</tr>
</tbody>
</table>
<div id="extract-to-split-column-names" class="section level5 unnumbered">
<h5></h5>
<p>Because these data are in wide format (multiple columns have contain the same type of data) we need to first convert to long format. This process has become known as <a href="http://tidyr.tidyverse.org">tidying</a>.</p>
<p>The code below selects the columns related to rainfall and temperature and then ‘melts’ the data to long format: one row per observation. We then <code>extract</code> the region and the type of measurement from the <code>variable</code> column which is created by using a regular expression:</p>
<pre class="sourceCode r"><code class="sourceCode r">weather.data.long &lt;-<span class="st"> </span>DAAG<span class="op">::</span>bomregions <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(Year, <span class="kw">ends_with</span>(<span class="st">&#39;Rain&#39;</span>), <span class="kw">ends_with</span>(<span class="st">&#39;AVt&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>reshape2<span class="op">::</span><span class="kw">melt</span>(<span class="dt">id.var=</span><span class="st">&quot;Year&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">extract</span>(variable, 
          <span class="dt">into=</span><span class="kw">c</span>(<span class="st">&quot;Region&quot;</span>, <span class="st">&quot;variable&quot;</span>), 
          <span class="dt">regex=</span><span class="st">&quot;(east|north|se|south|west|sw|au)(</span><span class="ch">\\</span><span class="st">w+)&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(variable))

weather.data.long <span class="op">%&gt;%</span><span class="st"> </span>head
  Year Region variable  value
<span class="dv">1</span> <span class="dv">1900</span>   east     Rain <span class="fl">429.98</span>
<span class="dv">2</span> <span class="dv">1901</span>   east     Rain <span class="fl">500.12</span>
<span class="dv">3</span> <span class="dv">1902</span>   east     Rain <span class="fl">315.33</span>
<span class="dv">4</span> <span class="dv">1903</span>   east     Rain <span class="fl">694.09</span>
<span class="dv">5</span> <span class="dv">1904</span>   east     Rain <span class="fl">564.86</span>
<span class="dv">6</span> <span class="dv">1905</span>   east     Rain <span class="fl">443.11</span></code></pre>
</div>
<div id="section-8" class="section level5 exercise">
<h5><span class="header-section-number">5.0.0.0.1</span> </h5>
<p>Try stepping through the code above line by line and see what is produced at each step.</p>
<p>With our data in long form we can use <code>ggplot</code> to plot our data over time. In the plot below, we use <code>filter()</code> to select only the rainfall measurements:</p>
<pre class="sourceCode r"><code class="sourceCode r">rain &lt;-<span class="st"> </span>
<span class="st">  </span>weather.data.long <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(variable<span class="op">==</span><span class="st">&#39;Rain&#39;</span>)

rain <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Year, value)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&#39;Rainfall (mm)&#39;</span>)</code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>There are many ways to extract structure from these data, and make comparisons over time. One is to use colour:</p>
<pre class="sourceCode r"><code class="sourceCode r">rain <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Year, value, <span class="dt">color=</span>Region)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&#39;Rainfall (mm)&#39;</span>)</code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>It’s now easy to see the crude differences between the regions (west appears the driest, sw the wettest), but it’s still hard to compare between regions, or over time.</p>
<p>For this we can use various forms of summaries, for example a smoothed line plot (the shaded area is the standard error), which clearly shows the relative changes in rainfall in each region over time:</p>
<pre class="sourceCode r"><code class="sourceCode r">rain <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Year, value, <span class="dt">color=</span>Region)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&#39;Rainfall (mm)&#39;</span>)
<span class="st">`</span><span class="dt">geom_smooth()</span><span class="st">`</span> using method =<span class="st"> &#39;loess&#39;</span></code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>It can sometimes be desireable to include points to preserve the relationship between the summary and the raw data:</p>
<pre class="sourceCode r"><code class="sourceCode r">rain <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(Region <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;west&#39;</span>, <span class="st">&#39;se&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Year, value, <span class="dt">color=</span>Region)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span>.<span class="dv">5</span>, <span class="dt">size=</span>.<span class="dv">5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se=</span>F) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&#39;Rainfall (mm)&#39;</span>)
<span class="st">`</span><span class="dt">geom_smooth()</span><span class="st">`</span> using method =<span class="st"> &#39;loess&#39;</span></code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>If we weren’t interested in the time series and just wanted to focus on the most recent year, we might take a different approach. Here a bar plot is used to compare between regions, with the national average (au) highlighted in blue:</p>
<pre class="sourceCode r"><code class="sourceCode r">rain <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(Year <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(Year)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Region, value, <span class="dt">fill=</span>Region<span class="op">==</span><span class="st">&quot;au&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_summary</span>(<span class="dt">geom=</span><span class="st">&quot;bar&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&#39;Rainfall (mm)&#39;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill=</span>F)
No summary <span class="cf">function</span> supplied, defaulting to <span class="st">`</span><span class="dt">mean_se()</span></code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>Finally, we shouldn’t forget that this dataset included both rainfall and temperature data, and we can display these in different ways, depending on what our research question was.</p>
<p>In this case we can use facetting to display temperature and rainfall data side by side. Because AVt and Rain are on such different scales we need to allow the y axis to vary between variables:</p>
<pre class="sourceCode r"><code class="sourceCode r">weather.data.long <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Year, value, <span class="dt">color=</span>Region)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>variable, <span class="dt">scales=</span><span class="st">&quot;free&quot;</span>)
<span class="st">`</span><span class="dt">geom_smooth()</span><span class="st">`</span> using method =<span class="st"> &#39;loess&#39;</span>
Warning<span class="op">:</span><span class="st"> </span>Removed <span class="dv">70</span> rows containing non<span class="op">-</span>finite <span class="kw">values</span> (stat_smooth).</code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<!-- ```{r} -->
<!-- dataurl <- function(year, country){ -->
<!--   sprintf("https://www.census.gov/population/international/data/idb/region.php?N=Results&T=10&A=separate&RT=0&Y=%.0f&R=-1&C=%s", 2017, "UK") -->
<!-- } -->
<!-- df <- read.csv(dataurl(2017, 'UK')) -->
<!-- ``` -->
</div>
</div>
<div id="composition" class="section level3 unnumbered">
<h3>‘Composition’</h3>
<div id="waffle-plots-or-pictograms" class="section level4 unnumbered">
<h4>Waffle plots or ‘pictograms’</h4>
<p>Waffle plots are neat way of showing the relative frequency of different categories.</p>
<p>In applied settings it’s well known that when considering the risks or benefits of interventions clinicans, patients and researchers benefit from statements made using ‘natural frequencies’ <span class="citation">[@gigerenzer2003simple]</span>, and pictographs or ‘waffle plots’ have been shown to provide patients and their families with a better understanding of the risks of treatments <span class="citation">[@tait2010presenting]</span>.</p>
<p>Waffle plots can be implemented in R via the <code>waffle::</code> package:</p>
<pre class="sourceCode r"><code class="sourceCode r">outcomes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;gained weight&quot;</span>=<span class="dv">13</span>, 
              <span class="st">&quot;no change&quot;</span>=<span class="dv">27</span>, 
              <span class="st">&quot;lost 2kg or more&quot;</span> =<span class="st"> </span><span class="dv">44</span>, 
              <span class="st">&quot;lost 5kg or more&quot;</span> =<span class="st"> </span><span class="dv">16</span>)

waffle<span class="op">::</span><span class="kw">waffle</span>(outcomes)</code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p><span class="tip">Calculating these summary figures is left as an exercise to for the reader, but see the section on <a href="a-generalised-approach.html#split-apply-combine">summarising data with dplyr</a>.</span></p>
<p>This is one of those occasions where the default ggplot colours could probably be improved, and we can do this by passing the <a href="colours.html#named-colours">names of the colours</a> we would like to use:</p>
<pre class="sourceCode r"><code class="sourceCode r">weight.loss.colours &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;firebrick2&#39;</span>, <span class="st">&#39;darkgoldenrod1&#39;</span>, <span class="st">&#39;palegreen3&#39;</span>, <span class="st">&#39;palegreen4&#39;</span>)
waffle<span class="op">::</span><span class="kw">waffle</span>(outcomes, <span class="dt">colors =</span> weight.loss.colours)</code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>Selecting colours by hand isn’t always the best way though: the <a href="colours.html#color-brewer"><code>colourbrewer</code> library provides some nice shortcuts</a> for using palletes from the excellent <a href="http://colorbrewer2.org">ColourBrewer website</a>.</p>
</div>
<div id="stacked-bars" class="section level4 unnumbered">
<h4>Stacked bars</h4>
<p>The <code>reshape2</code> package includes data on tipping habits in restaurants for male and female bill-payers, and where the party was fo various <code>size</code>s:</p>
<pre class="sourceCode r"><code class="sourceCode r">reshape2<span class="op">::</span>tips <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>head <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>pander</code></pre>
<table style="width:86%;">
<colgroup>
<col width="18%" />
<col width="9%" />
<col width="12%" />
<col width="12%" />
<col width="8%" />
<col width="12%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">total_bill</th>
<th align="center">tip</th>
<th align="center">sex</th>
<th align="center">smoker</th>
<th align="center">day</th>
<th align="center">time</th>
<th align="center">size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">16.99</td>
<td align="center">1.01</td>
<td align="center">Female</td>
<td align="center">No</td>
<td align="center">Sun</td>
<td align="center">Dinner</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">10.34</td>
<td align="center">1.66</td>
<td align="center">Male</td>
<td align="center">No</td>
<td align="center">Sun</td>
<td align="center">Dinner</td>
<td align="center">3</td>
</tr>
<tr class="odd">
<td align="center">21.01</td>
<td align="center">3.5</td>
<td align="center">Male</td>
<td align="center">No</td>
<td align="center">Sun</td>
<td align="center">Dinner</td>
<td align="center">3</td>
</tr>
<tr class="even">
<td align="center">23.68</td>
<td align="center">3.31</td>
<td align="center">Male</td>
<td align="center">No</td>
<td align="center">Sun</td>
<td align="center">Dinner</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="center">24.59</td>
<td align="center">3.61</td>
<td align="center">Female</td>
<td align="center">No</td>
<td align="center">Sun</td>
<td align="center">Dinner</td>
<td align="center">4</td>
</tr>
<tr class="even">
<td align="center">25.29</td>
<td align="center">4.71</td>
<td align="center">Male</td>
<td align="center">No</td>
<td align="center">Sun</td>
<td align="center">Dinner</td>
<td align="center">4</td>
</tr>
</tbody>
</table>
<p>To begin, we might like to plot tips by time of day:</p>
<pre class="sourceCode r"><code class="sourceCode r">reshape2<span class="op">::</span>tips <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(time, tip)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">stat_summary</span>(<span class="dt">geom=</span><span class="st">&quot;bar&quot;</span>)
No summary <span class="cf">function</span> supplied, defaulting to <span class="st">`</span><span class="dt">mean_se()</span></code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>And to facilitate the comparison between men and women we could colour portions of the bars using <code>position_stack()</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">reshape2<span class="op">::</span>tips <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(time, tip, <span class="dt">fill=</span>sex)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">stat_summary</span>(<span class="dt">geom=</span><span class="st">&quot;bar&quot;</span>, <span class="dt">position=</span><span class="kw">position_stack</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Tip ($)&quot;</span>)
No summary <span class="cf">function</span> supplied, defaulting to <span class="st">`</span><span class="dt">mean_se()</span></code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p>Or to reverse the comparisons:</p>
<pre class="sourceCode r"><code class="sourceCode r">reshape2<span class="op">::</span>tips <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(sex, tip, <span class="dt">fill=</span>time)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">stat_summary</span>(<span class="dt">geom=</span><span class="st">&quot;bar&quot;</span>, <span class="dt">position=</span><span class="kw">position_stack</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Tip ($)&quot;</span>)
No summary <span class="cf">function</span> supplied, defaulting to <span class="st">`</span><span class="dt">mean_se()</span></code></pre>
<p><img src="graphics_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="graphics-approaches.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="utility-plotting-functions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
