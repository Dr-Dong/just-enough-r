<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Just enough R</title>
  <meta name="description" content="‘Just enough’ R">
  <meta name="generator" content="bookdown 0.4 and GitBook 2.6.7">

  <meta property="og:title" content="Just enough R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Just enough R" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="linear-models-simple.html">
<link rel="next" href="anova-cookbook.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="https://hypothes.is/embed.js" async></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Just enough R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="start_here.html"><a href="start_here.html"><i class="fa fa-check"></i><b>2</b> Getting started with R and RStudio</a></li>
<li class="chapter" data-level="3" data-path="datasets.html"><a href="datasets.html"><i class="fa fa-check"></i><b>3</b> Datasets and dataframes</a></li>
<li class="chapter" data-level="4" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html"><i class="fa fa-check"></i><b>4</b> Placeholder</a></li>
<li class="chapter" data-level="5" data-path="summarising-data.html"><a href="summarising-data.html"><i class="fa fa-check"></i><b>5</b> Summarising data</a></li>
<li class="chapter" data-level="6" data-path="graphics.html"><a href="graphics.html"><i class="fa fa-check"></i><b>6</b> Graphics</a></li>
<li class="chapter" data-level="7" data-path="real-data.html"><a href="real-data.html"><i class="fa fa-check"></i><b>7</b> Working with ‘real’ data</a></li>
<li class="chapter" data-level="8" data-path="correlations.html"><a href="correlations.html"><i class="fa fa-check"></i><b>8</b> Correlations</a></li>
<li class="chapter" data-level="9" data-path="t-tests.html"><a href="t-tests.html"><i class="fa fa-check"></i><b>9</b> t-tests</a></li>
<li class="chapter" data-level="10" data-path="linear-models-simple.html"><a href="linear-models-simple.html"><i class="fa fa-check"></i><b>10</b> Introduction to linear models in R</a></li>
<li class="chapter" data-level="11" data-path="anova.html"><a href="anova.html"><i class="fa fa-check"></i><b>11</b> Anova in R</a><ul>
<li class="chapter" data-level="" data-path="anova.html"><a href="anova.html#rule-1-use-long-format-data"><i class="fa fa-check"></i>Rule 1: Use long format data</a></li>
<li class="chapter" data-level="" data-path="anova.html"><a href="anova.html#rule-2-know-your-variables"><i class="fa fa-check"></i>Rule 2: Know your variables</a></li>
<li><a href="anova.html#rule-3-dont-use-aov-or-anova">Rule 3: Don’t use <code>aov()</code> or <code>anova()</code></a></li>
<li class="chapter" data-level="" data-path="anova.html"><a href="anova.html#rule-4-use-type-3-sums-of-squares-and-learn-about-why"><i class="fa fa-check"></i>Rule 4: Use type 3 sums of squares (and learn about why)</a></li>
<li class="chapter" data-level="" data-path="anova.html"><a href="anova.html#general-anova-recommendations"><i class="fa fa-check"></i>General Anova recommendations</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="anova-cookbook.html"><a href="anova-cookbook.html"><i class="fa fa-check"></i><b>12</b> Anova ‘Cookbook’</a></li>
<li class="chapter" data-level="13" data-path="understanding-interactions.html"><a href="understanding-interactions.html"><i class="fa fa-check"></i><b>13</b> Understanding interactions (part 1)</a></li>
<li class="chapter" data-level="14" data-path="predictions-and-margins.html"><a href="predictions-and-margins.html"><i class="fa fa-check"></i><b>14</b> Making predictions</a></li>
<li class="chapter" data-level="15" data-path="mediation.html"><a href="mediation.html"><i class="fa fa-check"></i><b>15</b> Mediation</a></li>
<li class="chapter" data-level="16" data-path="multilevel-models.html"><a href="multilevel-models.html"><i class="fa fa-check"></i><b>16</b> Multilevel models</a></li>
<li class="chapter" data-level="17" data-path="cfa.html"><a href="cfa.html"><i class="fa fa-check"></i><b>17</b> Confirmatory factor analysis</a></li>
<li class="chapter" data-level="18" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>18</b> Installing R and RStudio</a></li>
<li class="chapter" data-level="19" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>19</b> Loading packages</a></li>
<li class="chapter" data-level="20" data-path="help.html"><a href="help.html"><i class="fa fa-check"></i><b>20</b> Getting help</a></li>
<li class="chapter" data-level="21" data-path="missing-values.html"><a href="missing-values.html"><i class="fa fa-check"></i><b>21</b> Missing values</a></li>
<li class="chapter" data-level="22" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html"><i class="fa fa-check"></i><b>22</b> Tips and tricks with RMarkdown</a></li>
<li class="chapter" data-level="23" data-path="confidence-vs-prediction-intervals.html"><a href="confidence-vs-prediction-intervals.html"><i class="fa fa-check"></i><b>23</b> Confidence, credible and prediction intervals</a></li>
<li class="chapter" data-level="24" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>24</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">‘Just enough’ R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="anova-in-r" class="section level1">
<h1><span class="header-section-number">11</span> Anova in R</h1>
<p>This section attempts to cover in a high level way how to specify anova models in R and some of the issues in interpreting the model output. If you just want the ‘answers’ — i.e. the syntax to specify common Anova models – you could skip to the next section: <a href="anova-cookbook.html">Anova cookbook</a></p>
<p>There are 4 rules for doing Anova in R and not wanting to cry:</p>
<ol style="list-style-type: decimal">
<li>Keep your data in ‘long’ format.</li>
<li>Know the differences between character, factor and numeric variables</li>
<li>Do not use the <code>aov()</code> or <code>anova()</code> functions to get an Anova table unless you know what you are doing.</li>
<li>Learn about the types of sums of squares and always remember to specify <code>type=3</code>, unless you know better.</li>
</ol>
<div id="rule-1-use-long-format-data" class="section level2 unnumbered">
<h2>Rule 1: Use long format data</h2>
<p>In R, data are almost always most useful a long format where:</p>
<ul>
<li>each row of the dataframe corresponds to a single measurement occasion</li>
<li>each column corresponds to a variable which is measured</li>
</ul>
<p>For example, in R we will have data like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df <span class="op">%&gt;%</span><span class="st"> </span>head <span class="op">%&gt;%</span><span class="st"> </span>pander</code></pre></div>
<table style="width:51%;">
<colgroup>
<col width="12%" />
<col width="9%" />
<col width="16%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">person</th>
<th align="center">time</th>
<th align="center">predictor</th>
<th align="center">outcome</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">7</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">12</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">3</td>
<td align="center">0</td>
<td align="center">11</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">3</td>
<td align="center">13</td>
</tr>
<tr class="odd">
<td align="center">2</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">3</td>
<td align="center">3</td>
<td align="center">11</td>
</tr>
</tbody>
</table>
<p>Whereas in SPSS we might have the same data structured like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df.wide <span class="op">%&gt;%</span><span class="st"> </span>head <span class="op">%&gt;%</span><span class="st"> </span>pander</code></pre></div>
<table style="width:67%;">
<colgroup>
<col width="12%" />
<col width="16%" />
<col width="12%" />
<col width="12%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">person</th>
<th align="center">predictor</th>
<th align="center">Time 1</th>
<th align="center">Time 2</th>
<th align="center">Time 3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">0</td>
<td align="center">7</td>
<td align="center">12</td>
<td align="center">11</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">3</td>
<td align="center">13</td>
<td align="center">5</td>
<td align="center">11</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">5</td>
<td align="center">10</td>
<td align="center">12</td>
<td align="center">10</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">2</td>
<td align="center">10</td>
<td align="center">12</td>
<td align="center">11</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">4</td>
<td align="center">9</td>
<td align="center">13</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">4</td>
<td align="center">9</td>
<td align="center">15</td>
<td align="center">9</td>
</tr>
</tbody>
</table>
<p>R always uses long form data when running an Anova, but one downside is that it therefore has no automatic to know which rows belong to which person (assuming individual people are the unit of error in your model). This means that for repeated measures designs you need to be careful to explicitly specify any repeated measures when specifying the model (see the section on repeated designs below).</p>
</div>
<div id="rule-2-know-your-variables" class="section level2 unnumbered">
<h2>Rule 2: Know your variables</h2>
<ul>
<li>factors, char, numeric etc. XXX This covered above XXX find link</li>
</ul>
</div>
<div id="rule-3-dont-use-aov-or-anova" class="section level2 unnumbered">
<h2>Rule 3: Don’t use <code>aov()</code> or <code>anova()</code></h2>
<p>This is the most important rule of all.</p>
<p>The <code>aov</code> and <code>anova</code> functions have been around in R a long time. For various historical reasons the defaults for these functions won’t do what you expect if you are used to SPSS, Stata, SAS and most other stats packages. These differences are important and will be confusing and give you misleading results unless you understand them.</p>
<p>The recommendation here is:</p>
<ul>
<li><p>If you have a factorial experiment use <code>car::Anova()</code> or <code>ez::ezANOVA()</code> as a replacement for <code>lm()</code>, <code>aov()</code> or <code>anova()</code>.</p></li>
<li><p>If you have repeated measures, your data are perfectly balanced, and you have no missing values then use <code>car::Anova()</code> or <code>ez::ezANOVA()</code>.</p></li>
<li><p>If you think you might want a repeat measures Anova but your data are not balanced or you have missing data, use <a href="multilevel-models.html">linear mixed models</a> instead via the <code>lme4::</code> package.</p></li>
</ul>
</div>
<div id="rule-4-use-type-3-sums-of-squares-and-learn-about-why" class="section level2 unnumbered">
<h2>Rule 4: Use type 3 sums of squares (and learn about why)</h2>
<p>You may be aware, but there are at least 3 different ways of calculating the sums of squares for each factor and interaction in an Anova. In short,</p>
<ul>
<li>SPSS and most other packages use type 3 sums of squares.</li>
<li><code>aov</code> and <code>anova</code> use type 1.</li>
<li>By default, <code>car::Anova</code> and <code>ez::ezANOVA</code> use type 2, but can use type 3 if you ask.</li>
</ul>
<p>What you should do:</p>
<ul>
<li>Make sure you use type 3 sums of squares unless you have a reason not to.</li>
<li>Always pass <code>type=3</code> as an argument when running an Anova.</li>
</ul>
<p>A longer explanation of <em>why</em> you probably want type 3 sums of squares is given in this <a href="https://stats.stackexchange.com/questions/60362/choice-between-type-i-type-ii-or-type-iii-anova">online discussion on stats.stackechange.com</a> and practical implications are shown in <a href="http://dwoll.de/rexrepos/posts/anovaSStypes.html">this worked example</a>.</p>
<p>An even longer answer, including a much deeper exploration of the philosophical questions involved is given by <span class="citation">Venables (<a href="#ref-venables1998exegeses">1998</a>)</span>.</p>
</div>
<div id="general-anova-recommendations" class="section level2 unnumbered">
<h2>General Anova recommendations</h2>
<ol style="list-style-type: decimal">
<li><p>Plot your raw data <em>first</em></p></li>
<li><p>Where you have interactions, be cautious in interpreting the main effects in your model, and always plot the model predictions (see <a href="understanding-interactions.html">understanding interactions</a>).</p></li>
<li><p>If you find yourself aggregating (averaging) data before running your model, think about using a <a href="multilevel-models.html">mixed or multilevel model</a> instead.</p></li>
<li><p>If you are using repeated measures Anova, check if you should should be using a <a href="multilevel-models.html">mixed model</a> instead. If you have an unbalanced design or any missing data, you probably should use a mixed model.</p></li>
</ol>

</div>
</div>
<h3> References</h3>
<div id="refs" class="references">
<div id="ref-venables1998exegeses">
<p>Venables, WN. 1998. “Exegeses on Linear Models.” In <em>S-Plus User’s Conference, Washington Dc</em>. <a href="http://www.stats.ox.ac.uk/pub/MASS3/Exegeses.pdf" class="uri">http://www.stats.ox.ac.uk/pub/MASS3/Exegeses.pdf</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="linear-models-simple.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="anova-cookbook.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["Just enough R.pdf", "Just enough R.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
